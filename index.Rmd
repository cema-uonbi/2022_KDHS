---
title: "Kenya DHS 2022"
output:
  flexdashboard::flex_dashboard:
    orientation: rows
    vertical_layout: scroll
runtime: shiny
resource_files:
- County.cpg
- County.dbf
- County.prj
- County.qpj
- County.sbn
- County.sbx
- County.shx
---
<!-- <style>                      -->
<!-- .navbar { -->
<!--   background-color:#A6674A; -->
<!-- } -->


<!-- </style>    -->




```{r, include=FALSE}

setwd("~/")
# load all the required packages
library(pacman)
p_load(docxtractr)
p_load(flexdashboard)
p_load(tidyverse)
p_load(ggiraph)
p_load(scales)
p_load(sf)
p_load(reshape2)
# import all the tables
#dhs2022report <- read_docx("2022KDHSKIR_KNBS.docx") 

# number of tables in the report

#docx_tbl_count(dhs2022report)
#tbls <- docx_extract_all_tbls(dhs2022report, trim = T, guess_header = T)

```

 {.tabset}
-----------------------------------------------------------------------

# Summary 

## Row {data-width="200"}

<br>

### {.value-box}

```{r}

valueBox(
  value = paste("37,911"),
  caption = "Total Number of Households Interviewed)",
  icon="fa-thumbs-down",
  color = "black"
)
```

### {.value-box}

```{r}
# valueBox(
#   value = paste("19,747"),
#   caption = "Full questionnaires",
#   color = "red"
# )
valueBox(
  value = paste("32,156"),
  caption = "Total Number of Women Interviewed",
  icon="fa-thumbs-up",
  color = "#b15928"
)
```

### {.value-box}

```{r}

# valueBox(
#   value = paste("18,164"),
#   caption = "Short questionnaires",
#   color = "darkgreen"
# )

valueBox(
  value = paste("14,453"),
  caption = "Total Number of Men Interviewed",
  color = "darkgreen",
  icon="fa-thumbs-up"
)
```

<br>

<br>



Column {data-width="600"}
---------------------------------

##### Choose the characteristics to display:

```{r}
radioButtons("quest", "",
             c("Households interviewed"="All",
               "Participants: Men"="Male",
               "Participants: Women"="Female"))

```


### **Summary of the households selected, occupied, and interviewed for the 2022 Kenya Demographic and Health Survey** 

The numbers are presented by:

  - Type of questionnaire (full or short questionnaires) 
  - Residence: Rural and urban
  - Participants: Men and women

```{r, fig.height=10,fig.height=22}
kdhshouseholdinterviews <- read_csv("table1_dhshhinterviews.csv") %>%
  dplyr::mutate(Households = recode(Households, "Households selected" = "Selected","Households occupied" = "Occupied", "Households interviewed" = "Interviewed"))

# include redundant columns in the household data to combine with the participant data
interviewvisuals <- kdhshouseholdinterviews %>%
  mutate(Gender="All") %>% 
  mutate(Participant="All") %>%
  rename(Respondents=Households)


## import data for participant interviews 
participantsinterviews <- read_csv("table1_participantsinterviews.csv") %>%
  dplyr::mutate(Participant = recode(Respondents, "Number of eligible women" = "Eligible women","Number of eligible women interviewed" = "Women interviewed", "Number of eligible men" = "Eligible men","Number of eligible men interviewed" = "Men interviewed"))

# join the two datasets
totalinterviewvisuals <- rbind(interviewvisuals ,participantsinterviews)  %>%
  mutate(selection=recode(selection, "Long questionnaire"="Full questionnaires", "Long_questionnaire"="Full questionnaires", "All_households"="All households",
                          "Short_questionnaire"="Short questionnaire"))

renderPlot({
 ggplot(totalinterviewvisuals[totalinterviewvisuals$Gender%in%input$quest,], aes(x=Respondents, y=numbers)) + 
  geom_bar(stat = "identity", position = position_dodge(), fill="cyan4") + #"#53A7DC"
  theme_bw() +
  geom_text(aes(label=format(numbers, big.mark=",")), size=5,hjust=1.5, color="white")+scale_y_continuous(label=comma)+
  coord_flip() + labs(x="Households", y="", fill="Residence")+
  facet_grid(residence~selection) +
  theme(text= element_text(size = 20, colour = "black", face = "bold")) +
  theme(strip.background =element_rect(fill="darkorange"))
        }, width = 1200, height=600) 


```




Indicators
================================

Inputs {.sidebar}
-----------------------------------
<br>

[Characteristics of Respondents](#respondents_characteristics)</br>

[Health Insurance Coverage](#health_insurance)</br>

[Disability among the household population](#disability_pop)</br>

[Fertility rates](#fertility)</br>

[Teenage pregnancy](#teenage_pregnancy)</br>

[Current use of contraception](#contraception_use)</br>

[Family planning need and demand among married women](#family_planning)</br>

[Maternal care](#maternal_care)</br>

[Vaccinations](#vaccinations)</br>

[Nutritional status](#nutr_status)</br>

[Insecticide treated nets](#treated_nets)</br>

[Knowledge about HIV prevention methods among youth](#hiv_prev)</br>

[Coverage of prior HIV testing](#hiv_test)</br>


[House ownership](#home_ownership)</br>

[Agricultural land ownership](#agric_land_ownership)</br>

[Non-agricultural land ownership](#nonagric_land_ownership)</br>

[Gender based violence](#physical_violence)</br>


respondents_characteristics {.hidden}
==================

Inputs {.sidebar}
-----------------------------------
<br>

[Characteristics of Respondents](#respondents_characteristics)</br>

[Health Insurance Coverage](#health_insurance)</br>

[Disability among the household population](#disability_pop)</br>

[Fertility rates](#fertility)</br>

[Teenage pregnancy](#teenage_pregnancy)</br>

[Current use of contraception](#contraception_use)</br>

[Family planning need and demand among married women](#family_planning)</br>

[Maternal care](#maternal_care)</br>

[Vaccinations](#vaccinations)</br>

[Nutritional status](#nutr_status)</br>

[Insecticide treated nets](#treated_nets)</br>

[Knowledge about HIV prevention methods among youth](#hiv_prev)</br>

[Coverage of prior HIV testing](#hiv_test)</br>

[House ownership](#home_ownership)</br>

[Agricultural land ownership](#agric_land_ownership)</br>

[Non-agricultural land ownership](#nonagric_land_ownership)</br>

[Gender based violence](#physical_violence)</br>

## Row {data-width="200"}

<br>

### {.value-box}

```{r}

valueBox(
  value = paste("32,156"),
  caption = "Number of women interviewed",
  color = "#b15928",
  icon='fa-female,'
)
```

### {.value-box}

```{r}
valueBox(
  value = paste("14,453"),
  caption = "Number of men interviewed",
  color = "darkgreen",
  icon='fa-male'
)
```

<br>

Column {data-width="600"}
-----------------------

#### **The background characteristics of the women and men interviewed in the 2022 KDHS**

*For each characteristic, we show the weighted percentage distributions of the women and men that participated in the survey. Choose the characteristic to display.*




```{r}

selectInput("char", "",
             c("Age of respondent"="Age",
               "Self-reported health status"="Health_Status",
               "Religion"="Religion",
               "Marital status (15-49years)"="Marital_Status",
               "Residence"="Residence",
               "Education status (highest level attended)"="Education_Status",
               "Wealth Quintile"="Wealth_Quintile",
               "By County"="County"))

```


```{r}

respondentsbyage <- read_csv("table2_ageparticipants.csv")%>%
  mutate(Indicator="Age")%>%
  rename(Grouping=Age)

# reported health status data
healthstatus <- read_csv("table2_selfreport_healthstatus.csv") %>%
  mutate(Health_status = fct_relevel(Health_status, 
            "Very bad","Bad","Moderate","Good","Very good"))%>%
  mutate(Indicator="Health_Status")%>%
  rename(Grouping=Health_status)

# religion
religionrespondents <- read_csv("table2_religionparticipants.csv") %>%
  mutate(Religion = fct_relevel(Religion, "Other","No religion", "Muslim","Catholic","Protestant/other Christian")) %>%
  mutate(Indicator="Religion") %>%
  rename(Grouping=Religion)

# Marital status
maritalstatusrespondents <- read_csv("table2_maritalstatusparticipants.csv") %>%
  mutate(Marital_status = fct_relevel(Marital_status, "Widowed","Living together", "Divorced/separated","Never married","Married")) %>% 
  mutate(Indicator="Marital_Status") %>%
  rename(Grouping=Marital_status)

# Place of residence 
residentrespondents <- read_csv("table2_residenceparticipants.csv") %>%
  mutate(Residence = fct_relevel(Residence, "Urban", "Rural")) %>%
  mutate(Indicator="Residence") %>%
  rename(Grouping=Residence)

# Education status
educationrespondents <- read_csv("table2_educationstatusparticipants.csv")  %>%
  mutate(Education_status = fct_relevel(Education_status, "Vocational", "More than secondary","Secondary", "Primary", "No education")) %>%
  mutate(Indicator="Education_Status") %>%
  rename(Grouping=Education_status)

# Wealth quintile
economicstatusrespondents <- read_csv("table2_economicstatus15_49.csv")  %>%
  mutate(Wealth_quintile = fct_relevel(Wealth_quintile, "Lowest", "Second","Middle", "Fourth", "Highest")) %>%
  mutate(Indicator="Wealth_Quintile") %>%
  rename(Grouping=Wealth_quintile)

# By county
countyrespondents <- read_csv("table2_participantsbycounty.csv") %>%
  arrange(desc(Weighted_percent)) %>%
  mutate(Indicator="County") %>%
  rename(Grouping=County)


  
# join the datasets with participants characteristics

respondentsdata <- rbind(respondentsbyage, healthstatus, religionrespondents, maritalstatusrespondents, residentrespondents, educationrespondents, economicstatusrespondents, countyrespondents) %>%
  mutate(Indicator1=Indicator) %>%
  mutate(Indicator1=recode(Indicator1, "Education_Status"="Education Status", "Health_Status"="Health Status", "Marital_Status"="Marital Status", "Wealth_Quintile"="Wealth Quintile")) %>%
  mutate(label=ifelse(Weighted_percent<0.5, "<1%", paste0(round(Weighted_percent),"%")))

respondentsdata$Grouping <- fct_relevel(respondentsdata$Grouping, "Lowest", "Second", "Middle", "Fourth", "Highest", #wealth quintile
                                        'No education','Primary','Secondary','More than secondary', 'Vocational', #Education
                                        "Protestant/other Christian","Catholic", "Muslim","No religion","Other", #Religion
                                        "Very good","Good","Moderate","Bad","Very bad", #Reported health status
                                        "Married","Never married","Divorced/separated","Living together","Widowed") #Marital status


# visualize the data
# renderPlot({
#   if (input$char%in%c("Wealth_Quintile", "Age")){
#    respondentsdata%>%
#     filter(Indicator==input$char)%>%
#     ggplot(aes(x=Grouping, y=Weighted_percent, color = Participants)) + 
#   geom_point(stat = "identity", size= 20) + 
#   theme_bw() +
#   geom_text(aes(label=paste0(Weighted_percent,"%")), hjust = 0.5, size=4, color="white")+
#   labs(y="Weighted percent (%)",x=paste0(unique(respondentsdata[respondentsdata$Indicator==input$char,]$Indicator1), " of respondents"), fill="Gender") +scale_color_manual(values=c("darkgreen", "red"))+
#   theme(text=element_text(size=18, face="bold"))}
#     else if(input$char%in%"County"){
#       respondentsdata%>%
#     filter(Indicator==input$char)%>%
#       ggplot(aes(x=reorder(Grouping,Weighted_percent), y=Weighted_percent, fill = Participants)) + 
#   geom_col(stat = "identity", size= 10) + coord_flip()+
#   theme_bw() +
#   geom_text(aes(label=Weighted_percent), position=position_stack(vjust = 0.5), size=4, color="white", label.size=0.7)+
#   labs(y="Weighted percent (%)",x=paste0(unique(respondentsdata[respondentsdata$Indicator==input$char,]$Indicator1), " of respondents"), fill="Gender") +scale_fill_manual(values=c("darkgreen", "red"))+
#   theme(text=element_text(size=20, face="bold")) 
#       
#     } else {
#      respondentsdata%>%
#     filter(Indicator==input$char)%>%
#     ggplot(aes(x=Grouping, y=Weighted_percent, fill = Participants)) + 
#   geom_col(stat = "identity", size= 10) + 
#   theme_bw() +
#   geom_text(aes(label=Weighted_percent), position=position_stack(vjust = 0.5), size=4, fill="white")+
#   labs(y="Weighted percent (%)",x=paste0(unique(respondentsdata[respondentsdata$Indicator==input$char,]$Indicator1), " of respondents"), fill="Gender") +scale_fill_manual(values=c("darkgreen", "red"))+
#   theme(text=element_text(size=20, face="bold")) 
#     }
#   }, width = 1420, height=700)
  

renderPlot({
  if (input$char%in%c("Wealth_Quintile", "Age")){
  respondentsdata%>%
    filter(Indicator==input$char)%>%
    ggplot(aes(x=Grouping, y=Weighted_percent)) + 
  geom_point(stat = "identity", size= 20, color = "cyan4")+#, aes(tooltip=paste0(Weighted_percent, "%"))) + 
  theme_bw() +
      facet_grid(~Participants) +
  geom_text(aes(label=label), hjust = 0.5, size=4, color="white", face = "bold")+
  #labs(y="Weighted percent (%)",x=paste0(unique(respondentsdata[respondentsdata$Indicator==input$char,]$Indicator1), " of respondents"), fill="Gender") +
      labs(y="Weighted percent (%)", x="")  +
     # scale_color_manual(values=c("cyan4", "red4"))+
       theme(strip.background =element_rect(fill="darkorange")) +
  theme(text=element_text(size=18, face="bold"))
   #respondents_map1a<-girafe(ggobj = respondents_map1,width_svg=18, height_svg=9,
  #                 options = list(
   #                  opts_hover(css = "fill:#666666;cursor:pointer;"),
    #                 opts_selection(css = "fill:orange;", type = "multiple"),
                    # opts_sizing(rescale = TRUE),
     #                opts_zoom(max = 4)))
#  print(respondents_map1a)
    } else if(input$char%in%"County"){
 respondentsdata%>%
    filter(Indicator==input$char)%>%
      ggplot(aes(x=reorder(Grouping,Weighted_percent), y=Weighted_percent)) + 
  geom_bar(stat = "identity", size= 10, fill = "cyan4") + coord_flip()+
  theme_bw() +
        facet_grid(~Participants) +
  geom_text(aes(label=label), hjust = -0.5, size=4, color="black", face = "bold", label.size=0.7)+
#  labs(y="Weighted percent (%)",x=paste0(unique(respondentsdata[respondentsdata$Indicator==input$char,]$Indicator1), " of respondents"), fill="Gender") + 
         labs(y="Weighted percent (%)", x="") + 
      #  scale_fill_manual(values=c("cyan4", "red4"))+
  theme(text=element_text(size=18, face="bold")) + theme(strip.background =element_rect(fill="darkorange"))
#  respondents_map2a<-girafe(ggobj = respondents_map2,width_svg=18, height_svg=9,
 #                  options = list(
  #                   opts_hover(css = "fill:#666666;cursor:pointer;"),
   #                  opts_selection(css = "fill:orange;", type = "multiple"),
                    # opts_sizing(rescale = TRUE),
    #                 opts_zoom(max = 4)))
 # print(respondents_map2a)
  }  else if(input$char%in%"Religion"){
  respondentsdata%>%
    filter(Indicator==input$char)%>%
      ggplot(aes(x=reorder(Grouping,Weighted_percent), y=Weighted_percent)) + 
  geom_bar(stat = "identity", size= 10, fill = "cyan4") + coord_flip()+
  theme_bw() +
        facet_grid(~Participants) +
  labs(y="Weighted percent (%)",x=paste0(unique(respondentsdata[respondentsdata$Indicator==input$char,]$Indicator1), " of respondents"), fill="Gender") + 
        # labs(y="Weighted percent (%)") + 
        scale_fill_manual(values=c("cyan4", "red4"))+
  theme(text=element_text(size=18, face="bold")) + theme(strip.background =element_rect(fill="darkorange"))+
      geom_text(aes(label=label), position=position_stack(vjust = 0.7), size=4, color="white", face = "bold", label.size=0.7)
   # respondents_map3a<-girafe(ggobj = respondents_map3,width_svg=18, height_svg=9,
  #                 options = list(
   #                  opts_hover(css = "fill:#666666;cursor:pointer;"),
    #                 opts_selection(css = "fill:orange;", type = "multiple"),
                     #opts_sizing(rescale = TRUE),
       #              opts_zoom(max = 4)))
#  print(respondents_map3a)
  } 
  else {
  respondentsdata%>%
    filter(Indicator==input$char)%>%
    ggplot(aes(x=Grouping, y=Weighted_percent)) + 
  geom_bar(stat = "identity", size= 10, fill = "cyan4")+ #aes(tooltip=paste0(Weighted_percent, "%"))) + 
  theme_bw() +
        facet_grid(~Participants) +
  geom_text(aes(label=label), position=position_stack(vjust = 0.5), size=5, color="white")+
 # labs(y="Weighted percent (%)",x=paste0(unique(respondentsdata[respondentsdata$Indicator==input$char,]$Indicator1), " of respondents"), fill="Gender") +scale_fill_manual(values=c("cyan4", "red4"))+
         labs(y="Weighted percent (%)", x="") +
  theme(text=element_text(size=18, face="bold")) +  theme(strip.background =element_rect(fill="darkorange")) 
  #  respondents_map4a<-girafe(ggobj = respondents_map4,width_svg=18, height_svg=9,
   #                options = list(
    #                 opts_hover(css = "fill:#666666;cursor:pointer;"),
     #                opts_selection(css = "fill:orange;", type = "multiple"),
                   #  opts_sizing(rescale = TRUE),
      #               opts_zoom(max = 4)))
  #print(respondents_map4)
  }
  }, width=1300, height=700)
  
```

health_insurance {.hidden}
==================

Inputs {.sidebar}
-----------------------------------
<br>

[Characteristics of Respondents](#respondents_characteristics)</br>

[Health Insurance Coverage](#health_insurance)</br>

[Disability among the household population](#disability_pop)</br>

[Fertility rates](#fertility)</br>

[Teenage pregnancy](#teenage_pregnancy)</br>

[Current use of contraception](#contraception_use)</br>

[Family planning need and demand among married women](#family_planning)</br>

[Maternal care](#maternal_care)</br>

[Vaccinations](#vaccinations)</br>

[Nutritional status](#nutr_status)</br>

[Insecticide treated nets](#treated_nets)</br>

[Knowledge about HIV prevention methods among youth](#hiv_prev)</br>

[Coverage of prior HIV testing](#hiv_test)</br>

[House ownership](#home_ownership)</br>

[Agricultural land ownership](#agric_land_ownership)</br>

[Non-agricultural land ownership](#nonagric_land_ownership)</br>

[Gender based violence](#physical_violence)</br>

## Row {data-width="200"} 

<br>

### {.value-box}

```{r}

valueBox(
value = paste("26%"),
   caption = "Of women have a form of health insurance",
   color = "#b15928", 
   icon='fa-female,' 
 ) 
``` 

### {.value-box}

```{r}
 valueBox( 
   value = paste("26.5%"), 
   caption = "Of men have a form of health insurance", 
   color = "darkgreen", 
   icon='fa-male' 
 )
 
```

Row {data-height="230"}
------------------------------- 

### **Health Insurance Coverage:**

 *Health insurance improves access to quality health care by reducing the costs associated with illness, treatment and care incurred by persons and/or families. The graphics show the percentage of de jure household members with insurance and the type of insurance.* 

**Choose the characteristics to display:**



```{r}
radioButtons("health", "",
              c("Age"="Age_category", 
                "Residence"="Residence", 
                "Wealth quintile"="Wealth_quintile"))
```


Row {data-height="600"}
------------------------------- 

### .

```{r, fig.width=16 }
# health insurance data by age
healthinsurancebyage <- read_csv("table3_healthinsurancebyage.csv") %>%
  tidyr::gather(Insurance,Coverage,2:7) %>%
  mutate(Insurance=recode(Insurance,"Any_health_insurance"="Form of health insurance", "None_DontKnow"="None/ Don't Know")) %>%
  rename(Indicator=Age_category) %>%
  mutate(Indicator1="Age_category")

# health insurance data by residence
healthinsurancebyresidence <-read_csv("table3_healthinsurancebyresidence.csv") %>%
  tidyr::gather(Insurance,Coverage,2:7) %>%
  mutate(Insurance=recode(Insurance,"Any_health_insurance"="Form of health insurance", "None_DontKnow"="None/ Don't Know")) %>%
  rename(Indicator=Residence) %>%
  mutate(Indicator1="Residence")

# Wealth quintile
healthinsurancebywealthquintile <- read_csv( "table3_healthinsurancebywealthquintile.csv") %>%
  tidyr::gather(Insurance,Coverage,2:7) %>%
  mutate(Insurance=recode(Insurance,"Any_health_insurance"="Form of health insurance", "None_DontKnow"="None/ Don't Know")) %>%
  rename(Indicator=Wealth_quintile) %>%
  mutate(Indicator1="Wealth_quintile")
  
# total health insurance data
healthinsurance <- rbind(healthinsurancebyage,healthinsurancebyresidence,healthinsurancebywealthquintile) %>%
  mutate(Insurance=recode(Insurance, "Community_based"="Community based", "Private_commercial"="Private/commercial")) %>%
  mutate(label=ifelse(Coverage<0.5, "<1%", paste0(round(Coverage),"%")))


healthinsurance$Indicator <- fct_relevel(healthinsurance$Indicator, "Lowest", "Second", "Middle", "Fourth", "Highest")

healthinsurance$Insurance <- fct_relevel(healthinsurance$Insurance, "NHIF", "Private/commercial", "Community based", "Other", "Form of health insurance", "None/ Don't Know")

renderPlot({
  if(input$health%in%"Wealth_quintile"){
    ggplot(healthinsurance[healthinsurance$Indicator1%in%input$health,], aes(x=Indicator, y=Coverage, fill=Participants))+geom_bar(stat = 'identity', position = position_dodge())+#,aes(tooltip=paste0(Coverage, "%"))) +
  facet_grid(.~Insurance)+labs(y="Proportion (%)")+
    scale_fill_brewer(palette = "Set1")+coord_flip()+
    theme_bw()+theme(text=element_text(size=16, face = "bold")) +
    theme(strip.background =element_rect(fill="darkorange"))+
    geom_text(aes(label=label), position=position_dodge(0.5),vjust=0.5, size=4, color="black")
  #  insurance_map1a<-girafe(ggobj = insurance_map1,width_svg=18, height_svg=9,
  #                 options = list(
  #                   opts_hover(css = "fill:#666666;cursor:pointer;"),
  #                   opts_selection(css = "fill:orange;", type = "multiple"),
                    # opts_sizing(rescale = TRUE),
   #                  opts_zoom(max = 4)))
  #print(insurance_map1a)
  }else{ 
  ggplot(healthinsurance[healthinsurance$Indicator1%in%input$health,], aes(x=Indicator, y=Coverage, fill=Participants))+geom_bar(stat = 'identity', position = position_dodge())+
  facet_grid(.~Insurance)+labs(y="Proportion (%)")+
    scale_fill_brewer(palette = "Set1")+
    theme_bw()+theme(text=element_text(size=20, face = "bold")) +
    theme(strip.background =element_rect(fill="darkorange"))+
       geom_text(aes(label=label), position=position_dodge(0.7),vjust=0.5, size=4, color="black")
  #insurance_map2a<-girafe(ggobj = insurance_map2, width_svg=18, height_svg=9,
   #                options = list(
    #                 opts_hover(css = "fill:#666666;cursor:pointer;"),
     #                opts_selection(css = "fill:orange;", type = "multiple"),
                  #   opts_sizing(rescale=TRUE),
      #               opts_zoom(max = 4)))
 # print(insurance_map2a, justify="left")
  }
})



```

disability_pop {.hidden}
==================

Inputs {.sidebar}
-----------------------------------
<br>

[Characteristics of Respondents](#respondents_characteristics)</br>

[Health Insurance Coverage](#health_insurance)</br>

[Disability among the household population](#disability_pop)</br>

[Fertility rates](#fertility)</br>

[Teenage pregnancy](#teenage_pregnancy)</br>

[Current use of contraception](#contraception_use)</br>

[Family planning need and demand among married women](#family_planning)</br>

[Maternal care](#maternal_care)</br>

[Vaccinations](#vaccinations)</br>

[Nutritional status](#nutr_status)</br>

[Insecticide treated nets](#treated_nets)</br>

[Knowledge about HIV prevention methods among youth](#hiv_prev)</br>

[Coverage of prior HIV testing](#hiv_test)</br>

[House ownership](#home_ownership)</br>

[Agricultural land ownership](#agric_land_ownership)</br>

[Non-agricultural land ownership](#nonagric_land_ownership)</br>

[Gender based violence](#physical_violence)</br>

## Row {data-width="200"}


### {.value-box}

```{r}

valueBox(
  value = paste("16%"),
  caption = "Some difficulty",
  color = "black"
)
```

### {.value-box}

```{r}
valueBox(
  value = paste("5%"),
  caption = "Alot of difficulty",
  color = "#b15928"
)
```

### {.value-box}

```{r}

valueBox(
  value = paste("0.5%"),
  caption = "Cannot do anything at all",
  color = "darkgreen"
)
```

<br>

Row {data-height="200"}
-----------------------

### Choose a category:

```{r}

radioButtons("disability", "",
              c("Age"="Age_category", 
                "Marital Status (15-49years)"="Marital_status", 
                "Residence"="Residence",
                "Education status (highest level attended)"="Education_status",
                "Wealth quintile"="Wealth_quintile"), width=250)
```

### Choose  a disability domain:

```{r }
radioButtons("disability_domain", "",
              c("Seeing"="Seeing", 
                "Hearing"="Hearing", 
                "Communicating"="Communicating",
                "Remembering/Concentrating"="Remembering_concentrating","Walking/ClimbingSteps"="Walking_ClimbingSteps",
                "Washing all over/Dressing"="washingAllOver_dressing"), width=250)

```

Row {data-height="600"}
-----------------------

### Kindly hover on the graph to see the actual values

```{r }
# disability by age
disabilitybyage <- read_csv( "table4_disabilitybyage.csv") %>%
  mutate(Indicator1 ="Age_category") %>%
  rename(Indicator=Age_category)

# disability by marital status
disabilitybymaritalstatus <- read_csv( "table4_disabilitybymaritalstatus.csv") %>%
  mutate(Indicator1="Marital_status") %>%
  rename(Indicator=Marital_status)

# disability by residence
disabilitybyresidence <- read_csv( "table4_disabilitybyresidence.csv") %>%
  mutate(Indicator1 = "Residence") %>%
  rename(Indicator=Residence)

# disability by education status
disabilitybyeducationstatus <- read_csv( "table4_disabilitybyeducationstatus.csv") %>%
  mutate(Indicator1 ="Education_status") %>%
  rename(Indicator=Education_status)
 
#disability by wealth quintile
disabilitybywealthquintile <- read_csv( "table4_disabilitybywealthquintile.csv") %>%
  mutate(Indicator1="Wealth_quintile") %>%
  rename(Indicator=Wealth_quintile)
  
disabilitydata <- rbind(disabilitybyage, disabilitybymaritalstatus, disabilitybyresidence, disabilitybyeducationstatus, disabilitybywealthquintile) %>%
  pivot_longer(c(No_difficulty, SomeDifficulty, A_lot_of_difficulty, Cannot_do_at_all, A_lot_of_difficulty_cannot_do_at_all, A_lot_of_difficulty_cannot_do_at_all_more_than_one_domain), names_to="difficulty", values_to="difficultyprop") %>%
  pivot_longer(c(Seeing, Hearing,Communicating, Remembering_concentrating, Walking_ClimbingSteps, WashingAllOver_dressing), names_to="impairment", values_to="impairmentvalues")%>%
  filter(difficulty%in%c("A_lot_of_difficulty","SomeDifficulty", "Cannot_do_at_all"))%>%
  mutate(difficulty=recode(difficulty, "A_lot_of_difficulty"="Alot of difficulty", "SomeDifficulty"="Some Difficulty","Cannot_do_at_all"="Cannot do at all"  ))%>%
  mutate(difficulty=fct_relevel(difficulty, "Some Difficulty", "Alot of difficulty", "Cannot do at all")) %>%
  mutate(Indicator2 =recode(Indicator1, "Age_category"="Age category", "Education_status"="Education status", "Marital_status"="Marital status", "Residence"="Residence", "Wealth_quintile"="Wealth quintile")) %>%
  mutate(label=ifelse(difficultyprop<0.5, "<1%", paste0(round(difficultyprop),"%")))

disabilitydata$Indicator <- fct_relevel(disabilitydata$Indicator, "Lowest", "Second", "Middle", "Fourth", "Highest",
                                        "50+","15-49","5-14",
                                        "Married","Never married","Divorced/separated","Living together","Widowed",
                                        'No education','Primary','Secondary','More than secondary', 'Vocational')

 renderGirafe({
   domain_data<- disabilitydata[disabilitydata$Indicator1==input$disability & disabilitydata$impairment%in%input$disability_domain,] %>%
       dplyr::select(impairmentvalues, Indicator, impairment, Participants)%>%
       dplyr::distinct()
   disability_map1<-ggplot(data=disabilitydata[disabilitydata$Indicator1==input$disability & disabilitydata$impairment%in%input$disability_domain,], ) + 
  geom_bar(aes(x=Indicator, y=difficultyprop, fill=difficulty),stat = "identity", position = position_dodge()) + 
    # geom_text(data=disabilitydata[disabilitydata$Indicator1==input$disability & disabilitydata$impairment%in%input$disability_domain,], aes(label=label, x=Indicator, y=difficultyprop),stat="identity", position = position_dodge(0.6), hjust=0.5)+
     geom_point_interactive(data=domain_data, aes(y=impairmentvalues, x=Indicator, tooltip=paste0(impairmentvalues, "%"), group=Participants),color="brown", size=10)+facet_grid(.~Participants)+
  theme_bw()+
  labs(y="Percent (%)", x=paste0(unique(disabilitydata[disabilitydata$Indicator1==input$disability,]$Indicator2) ," of respondents"), fill="Disability") +
  theme(text=element_text(size=20, face="bold"))+
     scale_fill_brewer(palette="Set1") 
   disability_map1a<-girafe(ggobj = disability_map1,width_svg=18, height_svg=9,
                   options = list(
                     opts_hover(css = "fill:#666666;cursor:pointer;"),
                     opts_selection(css = "fill:orange;", type = "multiple"),
                    # opts_sizing(rescale = TRUE),
                     opts_zoom(max = 4)))
  print(disability_map1a, justify="left")
})
```

fertility {.hidden}
==================

Inputs {.sidebar}
-----------------------------------
<br>

[Characteristics of Respondents](#respondents_characteristics)</br>

[Health Insurance Coverage](#health_insurance)</br>

[Disability among the household population](#disability_pop)</br>

[Fertility rates](#fertility)</br>

[Teenage pregnancy](#teenage_pregnancy)</br>

[Current use of contraception](#contraception_use)</br>

[Family planning need and demand among married women](#family_planning)</br>

[Maternal care](#maternal_care)</br>

[Vaccinations](#vaccinations)</br>

[Nutritional status](#nutr_status)</br>

[Insecticide treated nets](#treated_nets)</br>

[Knowledge about HIV prevention methods among youth](#hiv_prev)</br>

[Coverage of prior HIV testing](#hiv_test)</br>

[House ownership](#home_ownership)</br>

[Agricultural land ownership](#agric_land_ownership)</br>

[Non-agricultural land ownership](#nonagric_land_ownership)</br>

[Gender based violence](#physical_violence)</br>

## Row {data-width="200"}

<br>

### {.value-box}

```{r}

valueBox(
  value = paste("3.4"),
  caption = "Total Fertility Rate per woman (15-49) \n Urban areas:2.8 \n Rural areas: 3.9",
  color = "black"
)
```

### {.value-box}

```{r}
valueBox(
  value = paste("122"),
  caption = "General fertility rate, expressed per 1,000 women age 15–44\n Urban areas:105 \n Rural areas: 134",
  color = "#b15928"
)
```

### {.value-box}

```{r}

valueBox(
  value = paste("27.7"),
  caption = "Crude birth rate, expressed per 1,000 population \n Urban areas:30.1 \n Rural areas: 26.6",
  color = "darkgreen"
)
```

<br>




Column {data-width="600"}
--------------------------

<!-- ### Fertility trends -->

<!-- ```{r} -->

<!-- trendstotalfertilityrate <- read_csv( "figure1_trendstotalfertilityrate.csv")%>% -->


<!-- renderPlot({ -->
<!--   ggplot(trendstotalfertilityrate, aes(x=Years, y=`Total Fertility Rate`, group=Residence, fill=Residence, color=Residence))+geom_line(size=1.5)+geom_point(size=1.7)+theme_bw()+labs(x="Age category", y="Rate per 1,000 women")+theme(text=element_text(size=20, face="bold"))+scale_fill_brewer(palette = "Set1")+scale_color_brewer(palette = "Set1") -->
<!-- }) -->
<!-- ``` -->

### Current fertility rates


```{r, fig.width=15, fig.height=8}



agespecificfertilityrate <- read_csv( "table5_agespecificfertilityrate.csv") %>%
  pivot_longer(c(Urban, Rural, Total), names_to="Residence", values_to="Residenceprop")%>%
  filter(Residence!="Total")%>%
  mutate(Residenceprop=recode(Residenceprop, "[0]"="0", "[2]"="2", "[3]"="3", "[7]"="7")) %>%
  mutate(Residenceprop=as.numeric(Residenceprop))


ggplot(agespecificfertilityrate, aes(x=Age_category, y=Residenceprop))+geom_col(fill="#4C97C8")+facet_grid(Residence~.)+geom_text(aes(label=paste0(Residenceprop)), vjust=-0.5)+
    theme_bw()+labs(x="Age category", y="Rate per 1,000 women")+theme(text=element_text(size=20, face="bold"))



```

teenage_pregnancy {.hidden}
==================

Inputs {.sidebar}
-----------------------------------
<br>

[Characteristics of Respondents](#respondents_characteristics)</br>

[Health Insurance Coverage](#health_insurance)</br>

[Disability among the household population](#disability_pop)</br>

[Fertility rates](#fertility)</br>

[Teenage pregnancy](#teenage_pregnancy)</br>

[Current use of contraception](#contraception_use)</br>

[Family planning need and demand among married women](#family_planning)</br>

[Maternal care](#maternal_care)</br>

[Vaccinations](#vaccinations)</br>

[Nutritional status](#nutr_status)</br>

[Insecticide treated nets](#treated_nets)</br>

[Knowledge about HIV prevention methods among youth](#hiv_prev)</br>

[Coverage of prior HIV testing](#hiv_test)</br>

[House ownership](#home_ownership)</br>

[Agricultural land ownership](#agric_land_ownership)</br>

[Non-agricultural land ownership](#nonagric_land_ownership)</br>

[Gender based violence](#physical_violence)</br>

## Row {data-width="200"}

<br>

### {.value-box}

```{r}

valueBox(
  value = paste("12%"),
  caption = "of women aged 15-19 have ever had a live birth",
  color = "black"
)
```

### {.value-box}

```{r}
valueBox(
  value = paste("1%"),
  caption = "of women aged 15-19 have ever had a pregnancy loss",
  color = "#b15928"
)
```

### {.value-box}

```{r}

valueBox(
  value = paste("15%"),
  caption = "of women aged 15-19 have ever been pregnant",
  color = "darkgreen"
)
```

<br>

<br>

Row {data-height="800"}
-----------------------

### .

```{r}
teenpregnancybycountyvisual <- read_csv("table6_teenpregnancybycounty.csv") %>%
  pivot_longer(cols = Live_birth:Ever_pregnant, names_to = "Pregnancy", values_to = "Percent") %>%
  mutate(Pregnancy=recode(Pregnancy, "Currently_pregnant"="Currently pregnant", "Ever_pregnant"="Ever pregnant", "Live_birth"="Live birth", "Pregnancy_loss"="Pregnancy loss"))%>%
  mutate(label=ifelse(Percent<0.5, "<1%", paste0(round(Percent),"%")))


renderPlot({
 teenpregnancybycountyvisual %>%
  ggplot(aes(x=reorder(County,Percent), y=Percent, fill=Pregnancy)) + 
  geom_bar(stat = "identity") +
    geom_text(aes(label=label), position=position_stack(vjust=0.5))+
  #, position = position_dodge()) +
  #facet_wrap(facets = ~reorder(Participants, Percent)) +
  #scale_fill_manual("Residence", values = c("Urban" = "darkorange", "Rural" = "cyan3")) +
  theme_bw() +
  coord_flip() +
  ylab("Percent (%)") + xlab("County") +
  theme(text=element_text(size=20, face="bold")) +
  theme(strip.background =element_rect(fill="gray80")) +scale_fill_brewer(palette="Set1")
 # teenage_preg1a<-girafe(ggobj = teenage_preg1,width_svg=18, height_svg=9,
#                   options = list(
#                     opts_hover(css = "fill:#666666;cursor:pointer;"),
#                     opts_selection(css = "fill:orange;", type = "multiple"),
                  #   opts_sizing(rescale = TRUE),
 #                    opts_zoom(max = 4)))
  #print(teenage_preg1a, justify="left")
  }, width=1200, height=600)

  
```


nutr_status {.hidden}
==================

Inputs {.sidebar}
-----------------------------------
<br>

[Characteristics of Respondents](#respondents_characteristics)</br>

[Health Insurance Coverage](#health_insurance)</br>

[Disability among the household population](#disability_pop)</br>

[Fertility rates](#fertility)</br>

[Teenage pregnancy](#teenage_pregnancy)</br>

[Current use of contraception](#contraception_use)</br>

[Family planning need and demand among married women](#family_planning)</br>

[Maternal care](#maternal_care)</br>

[Vaccinations](#vaccinations)</br>

[Nutritional status](#nutr_status)</br>

[Insecticide treated nets](#treated_nets)</br>

[Knowledge about HIV prevention methods among youth](#hiv_prev)</br>

[Coverage of prior HIV testing](#hiv_test)</br>

[House ownership](#home_ownership)</br>

[Agricultural land ownership](#agric_land_ownership)</br>

[Non-agricultural land ownership](#nonagric_land_ownership)</br>

[Gender based violence](#physical_violence)</br>

## Row {data-width="200"}

<br>

### {.value-box}

```{r}

valueBox(
  value = paste("17.6%"),
  caption = "Moderate stunting",
  color = "black"
)
```

### {.value-box}

```{r}
valueBox(
  value = paste("5%"),
  caption = "Moderate wasting",
  color = "#b15928"
)
```

### {.value-box}

```{r}

valueBox(
  value = paste("10.1%"),
  caption = "Moderately underweight",
  color = "darkgreen"
)
```

<br>

Row {data-width="800"}
-------------------------------------

### Choose characteristics to display

```{r}

selectInput("nutr", "Choose background indicators to display:",
              c("Sex"="Sex", 
                "Residence"="Residence",
                "Mother's education"="Mother_education",
                "Wealth quintile"="Wealth_quintile"))

```


```{r}
#nut_age <- read_csv("table14_nutr_status_by_age.csv")%>%

nut_sex <- read_csv("table14_nutr_status_by_sex.csv")%>%
  mutate(measure=ifelse(indicator%in%"HFA","Stunting", ifelse(indicator%in%"WFH","Wasting","Underweight")))%>%
  mutate(lab = str_c(perc_below2sd,"%"))%>%
  mutate(Indicator1 ="Sex") %>%
  rename(Indicator=Sex)

nut_res <- read_csv("table14_nutr_status_by_residence.csv")%>%
  mutate(measure=ifelse(indicator%in%"HFA","Stunting", ifelse(indicator%in%"WFH","Wasting","Underweight")))%>%
  mutate(lab = str_c(perc_below2sd,"%"))%>%
  mutate(Indicator1 ="Residence") %>%
  rename(Indicator=Residence)

nut_motedu <- read_csv("table14_nutr_status_by_mother_edu.csv")%>%
  mutate(`Mother's education`=as.factor(fct_relevel(`Mother's education`, c("No education", "Primary", "Secondary", "More than secondary"))))%>%
  mutate(measure=ifelse(indicator%in%"HFA","Stunting", ifelse(indicator%in%"WFH","Wasting","Underweight")))%>%
  mutate(lab = str_c(perc_below2sd,"%"))%>%
  mutate(Indicator1 ="Mother_education") %>%
  rename(Indicator=`Mother's education`)

nut_wealth <- read_csv("table14_nutr_status_by_wealth.csv")%>%
  mutate(`Wealth quintile`=as.factor(fct_relevel(`Wealth quintile`, c("Lowest", "Second", "Middle", "Fourth", "Highest"))))%>%
  mutate(measure=ifelse(indicator%in%"HFA","Stunting", ifelse(indicator%in%"WFH","Wasting","Underweight")))%>%
  mutate(lab = str_c(perc_below2sd,"%"))%>%
  mutate(Indicator1 ="Wealth_quintile") %>%
  rename(Indicator=`Wealth quintile`)

nut_total <- rbind(nut_sex,nut_res,nut_motedu,nut_wealth)


renderPlot({
  if(input$nutr%in%c("Sex", "Residence")){
  ggplot(nut_total[nut_total$Indicator1%in%input$nutr,], aes(x=measure, y=perc_below2sd, fill=Indicator))+
  geom_bar(position="dodge", stat="identity")+
  theme_bw()+
  labs( y="Moderate", title="", x="Nutritional measure", fill="Residence")+
  scale_fill_manual(values = c("#f46d43","#74add1"))+
  theme(text=element_text(size=20, face="bold"))
  } else{
  ggplot(nut_total[nut_total$Indicator1%in%input$nutr,], aes(x=measure, y=perc_below2sd, fill=Indicator))+
  geom_dotplot(binaxis='y', stackdir='center', binwidth = 2)+
  theme_bw()+
  labs( y="Moderate", title="", x="Indicator", fill="")+
  scale_fill_manual(values = c("#f46d43","#fee090","#4575b4"))+
  theme(text=element_text(size=20, face="bold"))+
  geom_text(aes(label = lab), position=position_stack(hjust = 0.5), size=4) 
}
},width = 1300, height=400)

```

Row {data-width="600"}
-------------------------------------

### Choose characteristics to display


```{r}
selectInput("nutr2", "",
              c("Height for Age"="HFA",
                "Weight For Age"="WFA",
                "Weight for Height"="WFH"))
```


```{r, include=FALSE}
nutc <- read_csv("table14C_nutr_status_by_county.csv")%>%
  mutate(County=recode(County,"Tharaka-Nithi"="Tharaka Nithi", "Elgeyo/Marakwet"="Elgeyo Marakwet","Murang’a"="Muranga",
                       "Nairobi City"="Nairobi","Taita/Taveta"="Taita Taveta"))

county <- st_read("County.shp")%>%
  mutate(region=ifelse(Name%in%c("Kilifi","Kwale","Lamu", "Mombasa", "Taita Taveta", "Tana River"),"Coast", ifelse(Name%in%c("Garissa", "Mandera", "Wajir"),"North Eastern", ifelse(Name%in%c("Marsabit","Isiolo","Meru","Tharaka Nithi","Embu","Kitui","Machakos","Makueni"),"Eastern", ifelse(Name%in%c("Kiambu", "Kirinyaga","Muranga","Nyandarua", "Nyeri"),"Central", ifelse(Name%in%c("Bungoma",
 "Busia","Kakamega","Vihiga"),"Western", ifelse(Name%in%c("Kisumu", "Siaya","Homa Bay","Kisii", "Migori","Nyamira"),"Nyanza", ifelse(Name%in%"Nairobi","Nairobi", "Rift Valley"))))))))%>%
  rename(County=Name)
```





```{r}
nutc1 <- full_join(county, nutc, by="County")%>%
  mutate(measure=ifelse(indicator%in%"HFA","Stunting", ifelse(indicator%in%"WFH","Wasting","Underweight")))%>%
  mutate(names1=paste0(County,", ", perc_below3sd,"%","(",measure,")"))%>%
  mutate(names2=paste0(County,", ", perc_below2sd,"%","(",measure,")"))

renderGirafe({
  nut_map2 <- ggplot(nutc1[nutc1$indicator%in%input$nutr2,], aes(fill=perc_below2sd))+
    ggiraph::geom_sf_interactive(aes(tooltip = names2),size=0.3)+
    theme_void()+
    scale_fill_gradient(low = "white", high = "#8c2d04")+
    labs(x="", y="",fill="% below -2 SD^2 (Moderate)")+
    theme(text=element_text(size=14)) 
  nut_map2x<-girafe(ggobj = nut_map2,
                   options = list(
                     opts_hover(css = "fill:#666666;cursor:pointer;"),
                     opts_selection(css = "fill:orange;", type = "multiple"),
                     opts_zoom(max = 4)))
  print(nut_map2x)
})#,width = 1500, height=800)

```


### Nutritional status

```{r}
nutc1 <- full_join(county, nutc, by="County")%>%
  mutate(measure=ifelse(indicator%in%"HFA","Stunting", ifelse(indicator%in%"WFH","Wasting","Underweight")))%>%
  mutate(names1=paste0(County,", ", perc_below3sd,"%","(",measure,")"))%>%
  mutate(names2=paste0(County,", ", perc_below2sd,"%","(",measure,")"))

renderGirafe({
  nut_map1 <- ggplot(nutc1[nutc1$indicator%in%input$nutr2,], aes(fill=perc_below3sd))+
    ggiraph::geom_sf_interactive(aes(tooltip = names1),size=0.3)+
    theme_void()+
    scale_fill_gradient(low = "white", high = "#8c2d04")+
    labs(x="", y="",fill=" % below -3 SD (Severe)")+
    theme(text=element_text(size=14)) 
  nut_map1x<-girafe(ggobj = nut_map1,
                   options = list(
                     opts_hover(css = "fill:#666666;cursor:pointer;"),
                     opts_selection(css = "fill:orange;", type = "multiple"),
                     opts_zoom(max = 4)))
  print(nut_map1x)
})#,width = 1500, height=800)
```


treated_nets {.hidden}
==================

Inputs {.sidebar}
-----------------------------------
<br>

[Characteristics of Respondents](#respondents_characteristics)</br>

[Health Insurance Coverage](#health_insurance)</br>

[Disability among the household population](#disability_pop)</br>

[Fertility rates](#fertility)</br>

[Teenage pregnancy](#teenage_pregnancy)</br>

[Current use of contraception](#contraception_use)</br>

[Family planning need and demand among married women](#family_planning)</br>

[Maternal care](#maternal_care)</br>

[Vaccinations](#vaccinations)</br>

[Nutritional status](#nutr_status)</br>

[Insecticide treated nets](#treated_nets)</br>

[Knowledge about HIV prevention methods among youth](#hiv_prev)</br>

[Coverage of prior HIV testing](#hiv_test)</br>

[House ownership](#home_ownership)</br>

[Agricultural land ownership](#agric_land_ownership)</br>

[Non-agricultural land ownership](#nonagric_land_ownership)</br>

[Gender based violence](#physical_violence)</br>

## Row {data-width="200"}

<br>

### {.value-box}

```{r}

valueBox(
  value = paste("54.2%"),
  caption = "Households with at least 1 insecticide treated net",
  color = "black"
)
```

### {.value-box}

```{r}
valueBox(
  value = paste("1.2"),
  caption = "Average number of insecticide treated nets per household",
  color = "#b15928"
)
```

### {.value-box}

```{r}

valueBox(
  value = paste("37.1%"),
  caption = "Households with at least 1 insecticide treated net\n per 2 persons who stayed last night",
  color = "darkgreen"
)
```

<br>

Column {data-height="800"}
------------------------------- 


#### Choose characteristics to display

```{r}

selectInput("itn", "",
              c("Residence"="Residence",
                "Endemicity zone"="Endemicity zone",
                "Wealth quintile"="Wealth quintile", "By County"="County"))
```

```{r, include=F}
# import data

# by residence
itn_res <- read_csv("table18_ITN_by_residence.csv")%>%
  mutate(lab1 = str_c(perc_atleast_1itn,"%"))%>%
  mutate(lab2 = str_c(perc_atleast_1itn_2pple,"%"))

itn_res_x <- itn_res%>%
  pivot_longer(cols=c(perc_atleast_1itn,perc_atleast_1itn_2pple), names_to = "classification", values_to = "proportions")%>%
  mutate(classification=recode(classification,"perc_atleast_1itn"="Households with\n at least 1 ITN","perc_atleast_1itn_2pple"="Households with\n at least 1 ITN per 2 persons\n who stayed last night")) %>%
  mutate(indicator1="Residence") %>%
  rename(indicator=Residence)


# by endemicity zone
itn_endem <- read_csv("table18_ITN_by_endemicity_zone.csv")%>%
  mutate(lab1 = str_c(perc_atleast_1itn,"%"))%>%
  mutate(lab2 = str_c(perc_atleast_1itn_2pple,"%"))

itn_endem_x <- itn_endem%>%
  pivot_longer(cols=c(perc_atleast_1itn,perc_atleast_1itn_2pple), names_to = "classification", values_to = "proportions")%>%
  mutate(classification=recode(classification,"perc_atleast_1itn"="Households with\n at least 1 ITN","perc_atleast_1itn_2pple"="Households with\n at least 1 ITN per 2 persons\n who stayed last night")) %>%
  mutate(indicator1="Endemicity zone") %>%
  rename(indicator=`Endemicity zone`)

# by wealth
itn_wealth <- read_csv("table18_ITN_by_wealth_quintile.csv")%>%
  mutate(`Wealth quintile`=as.factor(fct_relevel(`Wealth quintile`, c("Lowest", "Second", "Middle", "Fourth", "Highest"))))%>%
  mutate(lab1 = str_c(perc_atleast_1itn,"%"))%>%
  mutate(lab2 = str_c(perc_atleast_1itn_2pple,"%"))

itn_wealth_x <- itn_wealth%>%
  pivot_longer(cols=c(perc_atleast_1itn,perc_atleast_1itn_2pple), names_to = "classification", values_to = "proportions")%>%
  mutate(classification=recode(classification,"perc_atleast_1itn"="Households with\n at least 1 ITN","perc_atleast_1itn_2pple"="Households with\n at least 1 ITN per 2 persons\n who stayed last night")) %>%
  mutate(indicator1="Wealth quintile") %>%
  rename(indicator=`Wealth quintile`)

# combine all the data
itn_data <- rbind(itn_res_x, itn_endem_x, itn_wealth_x)
# by county
itnc <- read_csv("table18C_ITN_by_county.csv")%>%
  mutate(County=recode(County,"Tharaka-Nithi"="Tharaka Nithi", "Elgeyo/Marakwet"="Elgeyo Marakwet","Murang’a"="Muranga",
                       "Nairobi City"="Nairobi","Taita/Taveta"="Taita Taveta")) %>%
  pivot_longer(cols=c(perc_atleast_1itn,perc_atleast_1itn_2pple), names_to = "classification", values_to = "proportions") %>%
  mutate(classification=recode(classification,"perc_atleast_1itn"="Households with\n at least 1 ITN","perc_atleast_1itn_2pple"="Households with\n at least 1 ITN per 2 persons\n who stayed last night")) %>%
  mutate(indicator1="County") %>%
  rename(indicator=County)
  

itn_data$indicator <- fct_relevel(itn_data$indicator, "Lowest","Second", "Middle", "Fourth", "Highest")

## by county

county <- st_read("County.shp")

itnc1 <- full_join(county, itnc[itnc$classification%in%"Households with\n at least 1 ITN",], by=c("Name"="indicator"))

itnc2 <- full_join(county, itnc[itnc$classification%in%"Households with\n at least 1 ITN per 2 persons\n who stayed last night",], by=c("Name"="indicator"))

itn_county <- rbind(itnc1, itnc2)
```

```{r}
renderPlot({
  if(input$itn%in%"Wealth quintile"){
    ggplot(itn_data[itn_data$indicator1%in%input$itn,],aes(x=indicator, y=proportions, color=classification))+
  geom_point(size=7)+
  theme_bw()+
  labs( y="%", title="", x=paste0(unique(itn_data[itn_data$indicator1%in%input$itn,]$indicator1)), color="")+
  scale_color_manual(values = c("#f46d43","#74add1"))+
  theme(text=element_text(size=16, face="bold"))
  }else if(input$itn%in%"County"){
    ggplot(itn_county)+
  geom_sf(data=itn_county, aes(geometry=geometry,fill=proportions))+facet_grid(.~classification)+
  theme_void()+
  scale_fill_gradient(low = "white", high = "#8c2d04")+
  labs(x="", y="%",fill="")+
  theme(text=element_text(size=14))} else{
    ggplot(itn_data[itn_data$indicator1%in%input$itn,],aes(x=indicator, y=proportions, fill=classification))+
  geom_bar(position="dodge", stat="identity")+
  theme_bw()+
  labs( y="%", title="", x=paste0(unique(itn_data[itn_data$indicator1%in%input$itn,]$indicator1)), fill="")+
  scale_fill_manual(values = c("#f46d43","#74add1"))+
  theme(text=element_text(size=16, face="bold"))
  }
    }, width=1500, height=800)

```


home_ownership {.hidden}
==================

Inputs {.sidebar}
-----------------------------------
<br>

[Characteristics of Respondents](#respondents_characteristics)</br>

[Health Insurance Coverage](#health_insurance)</br>

[Disability among the household population](#disability_pop)</br>

[Fertility rates](#fertility)</br>

[Teenage pregnancy](#teenage_pregnancy)</br>

[Current use of contraception](#contraception_use)</br>

[Family planning need and demand among married women](#family_planning)</br>

[Maternal care](#maternal_care)</br>

[Vaccinations](#vaccinations)</br>

[Nutritional status](#nutr_status)</br>

[Insecticide treated nets](#treated_nets)</br>

[Knowledge about HIV prevention methods among youth](#hiv_prev)</br>

[Coverage of prior HIV testing](#hiv_test)</br>

[House ownership](#home_ownership)</br>

[Agricultural land ownership](#agric_land_ownership)</br>

[Non-agricultural land ownership](#nonagric_land_ownership)</br>

[Gender based violence](#physical_violence)</br>

## Row {data-width="200"}

<br>

### {.value-box}

```{r}

valueBox(
  value = paste("4.5%"),
  caption = "Of women own a house alone",
  color = "black"
)
```

### {.value-box}

```{r}
valueBox(
  value = paste("36%"),
  caption = "of men own a house alone",
  color = "#b15928"
)
```

### {.value-box}

```{r}

valueBox(
  value = paste("9.4%"),
  caption = "Of women who own houses have their names on the title deed",
  color = "darkgreen"
)
```

### {.value-box}

```{r}

valueBox(
  value = paste("12.2%"),
  caption = "Of men who own houses have their names on the title deed",
  color = "darkblue"
)
```

<br>

Row {data.width=600}
-------------------------------------


#### House ownership

```{r}

selectInput("home_own", "",
              c("Age"="Age",
                "Education"="Education",
                "Residence"="residence",
                "Wealth quintile"="wealth"))

men_title_deed <- read_csv('table_27.2_house_has_a_title_deed.csv') %>%
  mutate(Participant = 'Male')
men_title_deed <- subset (men_title_deed, select = -Number)
names(men_title_deed) <- gsub("\\.", " ", names(men_title_deed))



percentage_own_house_men <- read_csv('table_27.2_percentage_who_own_a_house.csv')%>%
  mutate(Participant = 'Male')
percentage_own_house_men <- subset (percentage_own_house_men, select = -Number)
names(percentage_own_house_men) <- gsub("\\.", " ", names(percentage_own_house_men))


women_title_deed <- read_csv('table_27.1_house_has_a_title_deed.csv')%>%
  mutate(Participant = 'Female')
women_title_deed <- subset (women_title_deed, select = -Number)
names(women_title_deed) <- gsub("\\.", " ", names(women_title_deed))

percentage_own_house_women <- read_csv('table_27.1_percentage_who_own_a_house.csv')%>%
  mutate(Participant = 'Female')
percentage_own_house_women <- subset (percentage_own_house_women, select = -Number)
names(percentage_own_house_women) <- gsub("\\.", " ", names(percentage_own_house_women))


#-----age starts here
men_title_deed_age <- men_title_deed [c(2:8),c(0:6)]
women_title_deed_age <- women_title_deed[c(2:8),c(0:6)]


title_deed_age <-rbind(men_title_deed_age, women_title_deed_age)

title_deed_age <-melt(title_deed_age, id =c("Background Characteristic","Participant")) %>%
  mutate(indicator="Age")

## education

men_title_deed_education <- men_title_deed[c(15:18),c(0:6)]
women_title_deed_education <- women_title_deed[c(15:18),c(0:6)]


title_deed_education <-rbind(men_title_deed_education, women_title_deed_education)

title_deed_education  <-melt(title_deed_education,id =c("Background Characteristic","Participant")) %>%
  mutate(indicator="Education")

## residence
men_title_deed_residence <- men_title_deed[c(11:12),c(0:6)]
women_title_deed_residence <- women_title_deed[c(11:12),c(0:6)]


title_deed_residence <-rbind(men_title_deed_residence, women_title_deed_residence)

title_deed_residence  <-melt(title_deed_residence,id =c("Background Characteristic","Participant")) %>%
  mutate(indicator="residence")

# wealth

men_title_deed_wealth <- men_title_deed[c(21:25),c(0:6)]
women_title_deed_wealth <- women_title_deed[c(21:25),c(0:6)]


title_deed_wealth <-rbind(men_title_deed_wealth, women_title_deed_wealth)

title_deed_wealth  <-melt(title_deed_wealth,id =c("Background Characteristic","Participant")) %>%
  mutate(indicator="wealth")

# combine the data
title_deed_data <- rbind(title_deed_age, title_deed_education, title_deed_residence, title_deed_wealth)

renderPlot({ggplot(title_deed_data[title_deed_data$indicator%in%input$home_own,]) + 
  geom_col(mapping = aes(y = `Background Characteristic`, x=value, fill = Participant), position = 'dodge')+
  scale_colour_discrete(name="Own Title Deed")+
  xlim(0,100)+
  theme_bw()+
  labs(x ='Percentage (%)', y =paste0(title_deed_data[title_deed_data$indicator%in%input$home_own,]$indicator, " of respondents"), fill="Own Title Deed")+
  facet_grid(.~variable) +
  coord_flip()+theme(text = element_text(size=16, face="bold"))}, width=1500, height=800)

```




agric_land_ownership {.hidden}
==================

Inputs {.sidebar}
-----------------------------------
<br>

[Characteristics of Respondents](#respondents_characteristics)</br>

[Health Insurance Coverage](#health_insurance)</br>

[Disability among the household population](#disability_pop)</br>

[Fertility rates](#fertility)</br>

[Teenage pregnancy](#teenage_pregnancy)</br>

[Current use of contraception](#contraception_use)</br>

[Family planning need and demand among married women](#family_planning)</br>

[Maternal care](#maternal_care)</br>

[Vaccinations](#vaccinations)</br>

[Nutritional status](#nutr_status)</br>

[Insecticide treated nets](#treated_nets)</br>

[Knowledge about HIV prevention methods among youth](#hiv_prev)</br>

[Coverage of prior HIV testing](#hiv_test)</br>

[House ownership](#home_ownership)</br>

[Agricultural land ownership](#agric_land_ownership)</br>

[Non-agricultural land ownership](#nonagric_land_ownership)</br>

[Gender based violence](#physical_violence)</br>

## Row {data-width="200"}

<br>

### {.value-box}

```{r}

valueBox(
  value = paste("3.1%"),
  caption = "Of women own agricultural land alone",
  color = "black"
)
```

### {.value-box}

```{r}
valueBox(
  value = paste("26%"),
  caption = "of men own agricultural land alone",
  color = "#b15928"
)
```

### {.value-box}

```{r}

valueBox(
  value = paste("13.4%"),
  caption = "Of women who own agricultural land \n have their names on the title deed",
  color = "darkgreen"
)
```

### {.value-box}

```{r}

valueBox(
  value = paste("23.3%"),
  caption = "Of men who own agricultural land \n have their names on the title deed",
  color = "darkblue"
)
```

<br>

Column {data.height=800}
-------------------------

#### Agricultural land ownership

```{r, message=F}

selectInput("agric_own", "",
              c("Age"="Age",
                "Education"="Education",
                "Residence"="Residence",
                "Wealth quintile"="wealth quintile"))

```

```{r, include=F}
# agricultural land ownership

# load data
table28.1a <- read.csv('table_28.1_percentage_who_own_land.csv', encoding="UTF-8")  %>% 
  mutate(Participants='Women')
table28.1b<- read.csv('table_28.1_land_has_title_deed.csv', encoding="UTF-8") %>% 
  mutate(Participants='Women')
table28.2a <- read.csv('table_28.2_percentage_who_own_land.csv', encoding="UTF-8") %>% 
  mutate(Participants='Men')
table28.2b <- read.csv('table_28.2_land_has_title_deed.csv', encoding="UTF-8")  %>% 
  mutate(Participants='Men')
table28.3a <- read.csv('table_28.3_percentage_who_own_land.csv', encoding="UTF-8") %>% 
  mutate(Participants='Women')
table28.3b <- read.csv('table_28.3_land_has_a_title_deed.csv', encoding="UTF-8")%>%   
  mutate(Participants='Women')
table28.4a <- read.csv('table_28.4_percentage_who_own_land.csv', encoding="UTF-8") %>% 
  mutate(Participants='Men')
table28.4b <- read.csv('table_28.4_land_has_title_deed.csv', encoding="UTF-8")  %>% 
  mutate(Participants='Men')

county <- st_read("County.shp")


table28a <- dplyr::bind_rows(table28.1a, table28.2a) 
table28b <- dplyr::bind_rows(table28.1b, table28.2b) 
table28c <- dplyr::bind_rows(table28.3a, table28.4a) 
table28d <- dplyr::bind_rows(table28.3b, table28.4b) 

table28a <- table28a %>%
  melt(id = c("Background.characteristic", "Indicator", "Participants")) %>%
  mutate(value = as.numeric(value)) %>%
  mutate(variable=recode(variable, "Both.alone.and.jointly"="Both alone & jointly", "Percentage.who.do.not.own.land"="Percentage who do not own land")) %>%
  dplyr::filter(!variable%in%c("Total", "Number"))

```

```{r}
renderPlot({ggplot(table28a[table28a$variable!=c("Total", "Number") &table28a$Background.characteristic%in%input$agric_own,],mapping=aes(y=value, x=Indicator, fill=Participants)) +
  geom_col(position="dodge") + 
  facet_wrap(~variable) + 
  theme_bw() +
  labs( x = paste0(unique(table28a[table28a$variable!=c("Total", "Number") &table28a$Background.characteristic%in%input$agric_own,]$Background.characteristic), " of respondents"), y="%", fill="Land Ownership")+theme(text=element_text(size=20, face="bold"))}, width=1500, height=400)

```

##### Agricultural land documentation

```{r}
selectInput("agric_doc", "",
              c("Age"="Age",
                "Education"="Education",
                "Residence"="Residence",
                "Wealth quintile"="wealth quintile"))


table28b <- table28b %>%
  melt(id = c("Background.characteristic", "Indicator", "Participants")) %>%
  mutate(value = as.numeric(value)) %>%
  mutate(variable=recode(variable, "name.is.on.title.deed"="Name is on title deed", "name.is.not.on.title.deed"="Name is not on title deed", "Does.not.have.a.title.deed"="Does not have a title deed", "Don.t.know"="Don't know")) %>%
  dplyr::filter(!variable%in%c("Total", "Number"))


renderPlot({ggplot(table28b[table28b$variable!=c("Total", "Number") &table28b$Background.characteristic%in%input$agric_doc,], mapping=aes(y=value, x=Indicator, fill=Participants)) +
  geom_col(position="dodge") +
  facet_wrap(~variable) +
  theme_bw() +
  labs( x = paste0(unique(table28b[table28b$Background.characteristic%in%input$agric_doc,]$Background.characteristic), " of respondents"), y="%", fill="")+theme(text=element_text(size=16, face="bold"))
},width=1500, height=400)
```

nonagric_land_ownership {.hidden}
==================

Inputs {.sidebar}
-----------------------------------
<br>

[Characteristics of Respondents](#respondents_characteristics)</br>

[Health Insurance Coverage](#health_insurance)</br>

[Disability among the household population](#disability_pop)</br>

[Fertility rates](#fertility)</br>

[Teenage pregnancy](#teenage_pregnancy)</br>

[Current use of contraception](#contraception_use)</br>

[Family planning need and demand among married women](#family_planning)</br>

[Maternal care](#maternal_care)</br>

[Vaccinations](#vaccinations)</br>

[Nutritional status](#nutr_status)</br>

[Insecticide treated nets](#treated_nets)</br>

[Knowledge about HIV prevention methods among youth](#hiv_prev)</br>

[Coverage of prior HIV testing](#hiv_test)</br>

[House ownership](#home_ownership)</br>

[Agricultural land ownership](#agric_land_ownership)</br>

[Non-agricultural land ownership](#nonagric_land_ownership)</br>

[Gender based violence](#physical_violence)</br>

## Row {data-width="200"}

<br>

### {.value-box}

```{r}

valueBox(
  value = paste("1.4%"),
  caption = "Of women own non-agricultural land alone",
  color = "black"
)
```

### {.value-box}

```{r}
valueBox(
  value = paste("7.0%"),
  caption = "Of men own non-agricultural land alone",
  color = "#b15928"
)
```

### {.value-box}

```{r}

valueBox(
  value = paste("30.8%"),
  caption = "Of women who own non-agricultural land \n have their names on the title deed",
  color = "darkgreen"
)
```

### {.value-box}

```{r}

valueBox(
  value = paste("47.9%"),
  caption = "Of men who own non-agricultural land \n have their names on the title deed",
  color = "darkblue"
)
```

Column {data.height=800}
-------------------------


#### Non-agricultural land ownership 

```{r}
selectInput("nonagric_doc", "",
              c("Age"="Age",
                "Education"="Education",
                "Residence"="Residence",
                "Wealth quintile"="wealth quintile"))



table28c<-table28c %>%
  melt(id = c("Background.characteristic", "Indicator", "Participants")) %>%
  mutate(value = as.numeric(value)) %>%
  mutate(variable=recode(variable, "Both.alone.and.jointly"="Both alone & jointly", "Percentage.who.do.not.own.land"="Do not own land")) %>%
  dplyr::filter(!variable%in%c("Total", "Number"))
 
renderPlot({ggplot(table28c[table28c$variable!=c("Total", "Number") &table28c$Background.characteristic%in%input$nonagric_doc,], mapping=aes(y=value, x=Indicator, fill=Participants)) +
  geom_col(position="dodge") +
  facet_wrap(~variable) +
  theme_bw() +
  labs( x = paste0(unique(table28c[table28c$Background.characteristic%in%input$nonagric_doc,]$Background.characteristic), " of respondents"), y="%", fill="")+theme(text=element_text(size=16, face="bold"))
},width=1500, height=400)

```

##### Non-agricultural land documentation

```{r}
selectInput("nonagric_doc1", "",
              c("Age"="Age",
                "Education"="Education",
                "Residence"="Residence",
                "Wealth quintile"="wealth quintile"))

table28d <-table28d %>%
  melt(id = c("Background.characteristic", "Indicator", "Participants")) %>%
  mutate(value = as.numeric(value)) %>%
  mutate(variable=recode(variable, "Both.alone.and.jointly"="Both alone & jointly", "Percentage.who.do.not.own.land"="Do not own land")) %>%
  dplyr::filter(!variable%in%c("Total", "Number"))


renderPlot({ggplot(table28d[table28d$variable!=c("Total", "Number") &table28d$Background.characteristic%in%input$nonagric_doc1,], mapping=aes(y=value, x=Indicator, fill=Participants)) +
  geom_col(position="dodge") +
  facet_wrap(~variable) +
  theme_bw() +
  labs( x = paste0(unique(table28d[table28d$Background.characteristic%in%input$nonagric_doc1,]$Background.characteristic), " of respondents"), y="%", fill="")+theme(text=element_text(size=16, face="bold"))
},width=1500, height=400)
```

<br>



<!-- Column {data.height=800} -->
<!-- ------------------------- -->

contraception_use {.hidden}
==============================

Inputs {.sidebar}
-----------------------------------
<br>

[Characteristics of Respondents](#respondents_characteristics)</br>

[Health Insurance Coverage](#health_insurance)</br>

[Disability among the household population](#disability_pop)</br>

[Fertility rates](#fertility)</br>

[Teenage pregnancy](#teenage_pregnancy)</br>

[Current use of contraception](#contraception_use)</br>

[Family planning need and demand among married women](#family_planning)</br>

[Maternal care](#maternal_care)</br>

[Vaccinations](#vaccinations)</br>

[Nutritional status](#nutr_status)</br>

[Insecticide treated nets](#treated_nets)</br>

[Knowledge about HIV prevention methods among youth](#hiv_prev)</br>

[Coverage of prior HIV testing](#hiv_test)</br>

[House ownership](#home_ownership)</br>

[Agricultural land ownership](#agric_land_ownership)</br>

[Non-agricultural land ownership](#nonagric_land_ownership)</br>

[Gender based violence](#physical_violence)</br>

## Row {data-width="200"}

<br>

### {.value-box}

```{r}

valueBox(
  value = paste("63%"),
  caption = "of currently married women are using a contraceptive method",
  color = "black"
)
```

### {.value-box}

```{r}
valueBox(
  value = paste("70%"),
  caption = "of the unmarried women use a contraceptive",
  color = "#b15928"
)
```

### {.value-box}

```{r}

valueBox(
  value = paste("11%"),
  caption = "of sexually active unmarried women use traditional contraceptive methods",
  color = "darkgreen"
)
``` 

### {.value-box}

```{r}

valueBox(
  value = paste("6%"),
  caption = "of sexually active married women use traditional contraceptive methods",
  color = "darkblue"
)
```

<br>

Column {data-width="600"}
---------------------------------

##### Choose the characteristics to display: 


```{r}

selectInput("family_planning", "",
              c("Number of Children"="Number of children",
                "Age"="Age",
                "Education"="Education",
                "Residence"="Residence",
                "Wealth quintile"="Wealth quintile",
                "By County"="County"))

selectInput("fp_type", "Type of family planning",
              c("Any method:summary"="Any",
                "Modern method: Specific"="Modern",
                "Traditional method: Specific"="Traditional"))
```

```{r}


# import data

# family planning: any
fpanyusemarriedbynumberofchildrenvisual <- read_csv("fpanyusemarriedbynumberofchildren.csv") %>%
  mutate(Marital_status="Married") %>%
  mutate(indicator1="Number_of_children") %>%
  rename(Indicator=Number_of_children) %>%
  mutate(type="Any")

# by age
fpanyusemarriedunmarriedbyagevisual <- read_csv("table8_fpanyusemarriedunmarriedbyage.csv") %>%
  mutate(indicator1="Age") %>%
  rename(Indicator=Age_of_respondent) %>%
  mutate(type="Any")

# by residence
fpanyusemarriedunmarriedbyresidencevisual <- read_csv("table8_fpanyusemarriedunmarriedbyresidence.csv") %>%
  mutate(indicator1="Residence") %>%
  rename(Indicator=Residence) %>%
  mutate(type="Any")

# by education
fpanyusemarriedbyeducationvisual <- read.csv("table8_fpanyusemarriedbyeducation.csv") %>%
  mutate(Marital_status="Married") %>%
  mutate(indicator1="Education") %>%
  rename(Indicator="Education_status") %>%
  mutate(type="Any")

# wealth quintile
fpanyusemarriedbywealthvisual <- read.csv("table8_fpanyusemarriedbywealth.csv") %>%
  mutate(Marital_status="Married") %>%
  mutate(indicator1="Wealth_quintile") %>%
  rename(Indicator=Wealth_quintile) %>%
  mutate(type="Any")
  
# by county
fpanyusemarriedbycountyvisuals <- read_csv("table8c_fpanyusemarriedbycounty.csv") %>%
  mutate(Marital_status="Married") %>%
  mutate(indicator1="County") %>%
  rename(Indicator=County) %>%
  mutate(type="Any")

# by county: modern
modernfpusemarriedbycountyvisual <- read_csv("table8c_modernfpusemarriedbycounty.csv") %>%
  mutate(Marital_status="Married") %>%
  mutate(indicator1="County") %>%
  rename(Indicator=County) %>%
  mutate(type="Modern")

# by county: traditional
tradfpusemarriedbycounty <- read_csv("table8_tradfpusemarriedbycounty.csv") %>%
  mutate(Marital_status="Married") %>%
  mutate(indicator1="County") %>%
  rename(Indicator=County) %>%
  mutate(type="Traditional")


 
# modern family planing
# by number of children
modernfpusemarriedbynumberofchildren <- read.csv("table8_modernfpusemarriedbynumberofchildren.csv") %>% 
  mutate(indicator1="Number of children") %>%
  rename(Indicator=Number_of_children) %>%
  mutate(type="Modern")

#  by age
modernfpusemarriedandunmarriedbyagevisual <- read_csv("table8_modernfpusemarriedandunmarriedbyage.csv") %>%   
  mutate(indicator1="Age") %>%
  rename(Indicator=Age) %>%
  mutate(type="Modern")

# by residential
modernfpusemarriedandunmarriedbyresidencevisual <- read_csv("table8_modernfpusemarriedandunmarriedbyresidence.csv") %>%
  mutate(indicator1="Residence") %>%
  rename(Indicator=Residence) %>%
  mutate(type="Modern")

#by education
modernfpusemarrieducationvisual <- read_csv("table8_modernfpusemarrieducation.csv") %>%
  mutate(Education_status = fct_relevel(Education_status, 
                                        'No education','Primary','Secondary','More than secondary')) %>%
  mutate(Marital_status="Married") %>%
  mutate(indicator1="Education") %>%
  rename(Indicator="Education_status") %>%
  mutate(type="Modern")

# by wealth quintile
modernfpusemarriedbywealthquintilevisuals <- read_csv("table8_modernfpusemarriedbywealthquintile.csv") %>%
  mutate(Marital_status="Married") %>%
  mutate(indicator1="Wealth_quintile") %>%
  rename(Indicator="Wealth_quintile") %>%
  mutate(type="Modern")

# traditional methods

# by number of children
tradfpusmarriedbynumberofchildrenvisual <- read.csv("table8_tradfpusmarriedbynumberofchildren.csv") %>%
  mutate(Marital_status="Married") %>%
  mutate(indicator1="Number of children") %>%
  rename(Indicator=Number_of_children) %>%
  mutate(type="Traditional")

# by age
tradfpusemarriedandunmarriedbyagevisual <- read_csv("table8_tradfpusemarriedandunmarriedbyage.csv") %>% 
  mutate(indicator1="Age") %>%
  rename(Indicator=Age) %>%
  mutate(type="Traditional")

# by residence
tradfpusemarriedandunmarriedbyresidencevisual <- read_csv("table8_tradfpusemarriedandunmarriedbyresidence.csv") %>%
  mutate(indicator1="Residence") %>%
  rename(Indicator=Residence) %>%
  mutate(type="Traditional")

# by education
tradfpusemarriedbyeducationvisual <- read_csv("table8_tradfpusemarriedbyeducation.csv") %>%
  mutate(Education_status = fct_relevel(Education_status, 
                                        'No education','Primary','Secondary','More than secondary')) %>%
  mutate(Marital_status="Married") %>%
  mutate(indicator1="Education") %>%
  rename(Indicator="Education_status") %>%
  mutate(type="Traditional")

# by wealth quintile
tradfpusemarriedbywealthquintilevisual <- read_csv("table8_tradfpusemarriedbywealthquintile.csv") %>%
  mutate(Marital_status="Married") %>%
  mutate(indicator1="Wealth_quintile") %>%
  rename(Indicator="Wealth_quintile") %>%
  mutate(type="Traditional")

# join the data
family_planning <- rbind(fpanyusemarriedbynumberofchildrenvisual, fpanyusemarriedunmarriedbyagevisual, fpanyusemarriedunmarriedbyresidencevisual,fpanyusemarriedbyeducationvisual,fpanyusemarriedbywealthvisual, fpanyusemarriedbycountyvisuals, modernfpusemarriedbynumberofchildren, modernfpusemarrieducationvisual, modernfpusemarriedbywealthquintilevisuals, tradfpusmarriedbynumberofchildrenvisual,tradfpusemarriedandunmarriedbyagevisual, tradfpusemarriedbyeducationvisual,tradfpusemarriedbywealthquintilevisual, modernfpusemarriedandunmarriedbyagevisual) %>%
  mutate(Contraceptive_use=recode(Contraceptive_use, "Any_method"="Any method", "Modern_method"="Modern method", "Traditional_method"="Traditional method")) %>%
  mutate(indicator1= recode(indicator1, "Number_of_children"="Number of children", "Wealth_quintile"="Wealth quintile")) %>%
  mutate(Percent=as.numeric(parse_number(Percent)))

renderPlot({if(input$family_planning%in%"County"){
  ggplot(family_planning[family_planning$indicator1%in%input$family_planning & family_planning$type%in%"Any",], aes(x=Indicator, y=Percent, fill=Contraceptive_use)) +
  geom_bar(stat = "identity", position = "dodge") +
  theme_bw() + facet_grid(.~Marital_status)+coord_flip()+geom_text(aes(label=round(Percent)))+
    labs(y="Percent (%)", x=paste0(unique(family_planning[family_planning$indicator1%in%input$family_planning & family_planning$type%in%input$fp_type,]$indicator1)), fill="Type of contraceptive")+
  #coord_flip() +
  #theme(strip.text.x = element_text(size = 12, colour = "black", face = "bold")) +
  #theme(strip.text.y = element_text(size = 12, colour = "black", face = "bold")) +
  theme(text=element_text(size=20, face="bold")) +
  theme(strip.background =element_rect(fill="gray80"))
}else if(input$family_planning%in%"Residence"){
  ggplot(family_planning[family_planning$indicator1%in%input$family_planning & family_planning$type%in%"Any",], aes(x=Indicator, y=Percent, fill=Contraceptive_use)) +
  geom_bar(stat = "identity", position = "dodge") + geom_text(aes(label=round(Percent)), position=position_dodge(0.5), hjust=0.1)+
  theme_bw() + facet_grid(.~Marital_status)+
    labs(y="Percent (%)", x=paste0(unique(family_planning[family_planning$indicator1%in%input$family_planning & family_planning$type%in%input$fp_type,]$indicator1)), fill="Type of contraceptive")+
  #coord_flip() +
  #theme(strip.text.x = element_text(size = 12, colour = "black", face = "bold")) +
  #theme(strip.text.y = element_text(size = 12, colour = "black", face = "bold")) +
  theme(text=element_text(size=20, face="bold")) +
  theme(strip.background =element_rect(fill="gray80"))}
  else{ ggplot(family_planning[family_planning$indicator1%in%input$family_planning & family_planning$type%in%input$fp_type,], aes(x=Indicator, y=Percent, fill=Contraceptive_use)) +
  geom_bar(stat = "identity", position = "dodge") + geom_text(aes(label=round(Percent)), position=position_dodge(0.5), vjust=-0.2)+
  theme_bw() + facet_grid(.~Marital_status)+
    labs(y="Percent (%)", x=paste0(unique(family_planning[family_planning$indicator1%in%input$family_planning & family_planning$type%in%input$fp_type,]$indicator1)), fill="Type of contraceptive")+
  #coord_flip() +
  #theme(strip.text.x = element_text(size = 12, colour = "black", face = "bold")) +
  #theme(strip.text.y = element_text(size = 12, colour = "black", face = "bold")) +
  theme(text=element_text(size=20, face="bold")) +
  theme(strip.background =element_rect(fill="gray80"))
  }}, width=1400, height=600)




```

physical_violence {.hidden}
==============================

Inputs {.sidebar}
-----------------------------------
<br>

[Characteristics of Respondents](#respondents_characteristics)</br>

[Health Insurance Coverage](#health_insurance)</br>

[Disability among the household population](#disability_pop)</br>

[Fertility rates](#fertility)</br>

[Teenage pregnancy](#teenage_pregnancy)</br>

[Current use of contraception](#contraception_use)</br>

[Family planning need and demand among married women](#family_planning)</br>

[Maternal care](#maternal_care)</br>

[Vaccinations](#vaccinations)</br>

[Nutritional status](#nutr_status)</br>

[Insecticide treated nets](#treated_nets)</br>

[Knowledge about HIV prevention methods among youth](#hiv_prev)</br>

[Coverage of prior HIV testing](#hiv_test)</br>

[House ownership](#home_ownership)</br>

[Agricultural land ownership](#agric_land_ownership)</br>

[Non-agricultural land ownership](#nonagric_land_ownership)</br>

[Gender based violence](#physical_violence)</br>

## Row {data-width="200"}

<br>

### {.value-box}

```{r}

valueBox(
  value = paste("34%"),
  caption = "of women have experienced physical violence since age 15",
  color = "black"
)
```

### {.value-box}

```{r}
valueBox(
  value = paste("3.5%"),
  caption = "of women have often experienced physical violence in the last 12 months",
  color = "#b15928"
)
```


<br>

Row {data-width="600"}
---------------------------------

### Physical violence characteristics

```{r}

selectInput("physical_violence", "",
              c("Age"="Age",
                "Education"="Education",
                "Marital status"="Marital status",
                "Wealth quintile"="Wealth quintile"))
```

```{r, include=F}
## import data
# load data
table29_men<- read.csv('table_29_Men.csv') %>% 
  mutate(Participants='Men')
table29_women<- read.csv('table_29_Women.csv',na.strings="na") %>% 
  mutate(Participants='Women')
table29C_women<- read.csv('table_29C_Women.csv',na.strings="na") %>% 
  mutate(Participants='Women')
table29C_men<- read.csv('Table29C_Men.csv',na.strings="na") %>% 
  mutate(Participants='Men')
county <- st_read("County.shp")

table29 <- dplyr::bind_rows(table29_women)
table29C <- dplyr::bind_rows(table29C_women) %>%
  select(-Number)%>%
  pivot_longer(c(2:5), names_to="experience", values_to="value") 
  





```

```{r}

renderPlot({
  ggplot(table29[table29$Background.characteristic%in%input$physical_violence,], aes(x=Indicator,y=Value,fill=Category)) + 
  geom_col(position='dodge') + geom_text(aes(label=paste0(round(Value),"%")))+
  labs( y = 'Percentage(%)',x = '',fill='Experience of Violence', title="Marital Status") +
      theme_bw() + scale_fill_brewer(palette="Paired") + coord_flip()+ theme(text=element_text(size=20, face="bold")) }, width=1300, height=300)



```


<br>

Column {data-height="600"}
---------------------------------

### County data by experience of physical violence

```{r}

selectInput("physical_violence1", "",
              c("Experienced physical violence since age 15"="Percentage.who.have.experienced.physical.violence.since.age.15",
                "Often"="Often",
                "Sometimes"="Sometimes",
                "Often or Sometimes"="Often.or.sometimes"))


renderGirafe({
physical_violence <- left_join(county,table29C[table29C$experience%in%input$physical_violence1 ,],by=c("Name"="Background.characteristic")) %>%
  mutate(label=paste0(Name, ":", "\n", value, "%"))

#table29C<-table29C[c(0:47),c(0:7)]
#men <- full_join(county,table29C_men,by=c("Name"="Background.characteristic")) %>%
#  mutate(sex="Men")


#physical_violence <- rbind(women, men)

  physical_violencemap <-ggplot(physical_violence) + geom_sf_interactive(aes(fill=value, tooltip=label))+
  theme_void()+scale_fill_gradient(low="#ffffcc", high="#bd0026")+
  labs(fill="Percentage")
   physical_violencemap1 <- girafe(ggobj = physical_violencemap,
                   options = list(
                     opts_hover(css = "fill:#666666;cursor:pointer;"),
                     opts_selection(css = "fill:orange;", type = "multiple"),
                     opts_zoom(max = 4)))
    print(physical_violencemap1)

})


```

### County data

<br>
<br>

```{r}
renderPlot({
   physical_violence <- left_join(county,table29C[table29C$experience%in%input$physical_violence1 ,],by=c("Name"="Background.characteristic")) 

   ggplot(physical_violence, aes(x = reorder(Name,value),y = value)) + 
  geom_bar(stat="identity", aes(fill=Participants)) + coord_flip() + theme_bw()+ geom_text(aes(label=paste0(round(value),"%")))+
  labs(fill="Percentage", x="County", y="Percentage")+theme(text=element_text(size=18, face="bold"))
},width=800, height=500)


```


maternal_care {.hidden}
==============================

Inputs {.sidebar}
-----------------------------------
<br>

[Characteristics of Respondents](#respondents_characteristics)</br>

[Health Insurance Coverage](#health_insurance)</br>

[Disability among the household population](#disability_pop)</br>

[Fertility rates](#fertility)</br>

[Teenage pregnancy](#teenage_pregnancy)</br>

[Current use of contraception](#contraception_use)</br>

[Family planning need and demand among married women](#family_planning)</br>

[Maternal care](#maternal_care)</br>

[Vaccinations](#vaccinations)</br>

[Nutritional status](#nutr_status)</br>

[Insecticide treated nets](#treated_nets)</br>

[Knowledge about HIV prevention methods among youth](#hiv_prev)</br>

[Coverage of prior HIV testing](#hiv_test)</br>

[House ownership](#home_ownership)</br>

[Agricultural land ownership](#agric_land_ownership)</br>

[Non-agricultural land ownership](#nonagric_land_ownership)</br>

[Gender based violence](#physical_violence)</br>

## Row {data-width="200"}

<br>

### {.value-box}

```{r}

valueBox(
  value = paste("89%"),
  caption = "of women who had a live birth \n in the 
2 years preceding the survey \n were delivered \n by a skilled provider
",
  color = "black"
)
```

### {.value-box}

```{r}
valueBox(
  value = paste("82%"),
  caption = "of women who had a live birth \n in the 
2 years preceding the survey \n delivered \n in a health facility",
  color = "#b15928"
)
```

### {.value-box}

```{r}

valueBox(
  value = paste("66%"),
  caption = "of women who had a live birth \n in the 
2 years preceding the survey \n had 4+ \n ANC visits",
  color = "darkgreen"
)

``` 

<br>

<br>

Row {data-height="250"}
---------------------------------

### Maternal care

```{r}

radioButtons("maternal_care", "",
              c("Antenatal care from a skilled provider"="ANC from a skilled provider",
                "At least four antenatal care visits"="At least four ANC visits",
                "Took iron containing supplements during pregnancy"="Took iron supplements", "Most recent live birth was protected against neonatal tetanus"="Neonatal tetanus", "Delivered by a skilled provider"="Skilled delivery","Delivered in a health facility"="Health facility delivery", "Postnatal check during the first 2 days after birth"="Postnatal check"), width=600)

```

Column {data-height="600"}
---------------------------------
### Spatial visualization

```{r}
# import data

maternalcarebycounty <- read_csv("table10c_maternalcarebycounty.csv")%>% 
  mutate(County=recode(County,"Tharaka-Nithi"="Tharaka Nithi", "Elgeyo/Marakwet"="Elgeyo Marakwet","Murang’a"="Muranga","Nairobi City"="Nairobi","Taita/Taveta"="Taita Taveta")) %>%
  mutate(names1=paste0(County,", ", Percent,"%"))
  


# join the data with the shapefile
maternalcarebycounty1 <- left_join(county, maternalcarebycounty, by=c("Name"="County"))

renderGirafe({
  
  map4<- ggplot(maternalcarebycounty1[maternalcarebycounty1$`Maternal care`%in%input$maternal_care,])+
  geom_sf_interactive(aes(fill=Percent, tooltip=names1),color="grey80", size=0.0)+
  theme_void()+
  scale_fill_gradient(low = "white", high = "#8c2d04")+
  labs(x="", y="",fill="Proportion")+
  theme(text=element_text(size=14))
  x <- girafe(ggobj = map4,
                   options = list(
                     opts_hover(css = "fill:#666666;cursor:pointer;"),
                     opts_selection(css = "fill:orange;", type = "multiple"),
                     opts_zoom(max = 4)), width=8, height=7)
    print(x)})

```

### Maternal care data in descending order

```{r}

renderPlot({
  ggplot(maternalcarebycounty1[maternalcarebycounty1$`Maternal care`%in%input$maternal_care,], aes(x=reorder(Name, Percent), y=Percent)) +
geom_bar(stat = "identity", position = position_dodge(), fill="cyan4") +
  theme_bw() + coord_flip() +
  geom_text(aes(label=Percent), hjust=1.3, size=5, color="white")+
  coord_flip() + 
  ylab("Weighted percent") + xlab("County") +
 # facet_grid(~Family_planning) +
  theme(text=element_text(size=18, face="bold"))
   
})

```


<br>

hiv_prev {.hidden}
==============================

Inputs {.sidebar}
-----------------------------------

<br>

[Characteristics of Respondents](#respondents_characteristics)</br>

[Health Insurance Coverage](#health_insurance)</br>

[Disability among the household population](#disability_pop)</br>

[Fertility rates](#fertility)</br>

[Teenage pregnancy](#teenage_pregnancy)</br>

[Current use of contraception](#contraception_use)</br>

[Family planning need and demand among married women](#family_planning)</br>

[Maternal care](#maternal_care)</br>

[Vaccinations](#vaccinations)</br>

[Nutritional status](#nutr_status)</br>

[Insecticide treated nets](#treated_nets)</br>

[Knowledge about HIV prevention methods among youth](#hiv_prev)</br>

[Coverage of prior HIV testing](#hiv_test)</br>

[House ownership](#home_ownership)</br>

[Agricultural land ownership](#agric_land_ownership)</br>

[Non-agricultural land ownership](#nonagric_land_ownership)</br>

[Gender based violence](#physical_violence)</br>

## Row {data-width="200"}

<br>

### {.value-box}


```{r}

valueBox(
  value = paste("54.2%"),
  caption = "of women aged 15-24 had knowledge about HIV prevention",
  color = "black"
)

```

### {.value-box}

```{r}
valueBox(
  value = paste("55.2%"),
  caption = "of men aged 15-24 had knowledge about HIV prevention",
  color = "#b15928"
)
```



<br>

Column {data-height="800"}
---------------------------------

### Knowledge on HIV prevention

```{r}

selectInput("hiv", "",
              c("Knowledge about HIV prevention"="hivprevention_knowledge",
                "Limiting sexual intercourse to one uninfected partner"="limit_sex",
                "Using condoms"="using_condoms"))


# import data

hivc <- read_csv("table23_hiv_count_data.csv")%>%
  mutate(County=recode(County,"Tharaka-Nithi"="Tharaka Nithi", "Elgeyo/Marakwet"="Elgeyo Marakwet","Elgeyo-Marakwet"="Elgeyo Marakwet","Murang’a"="Muranga","Murang'a"="Muranga","Nairobi City"="Nairobi","Taita/Taveta"="Taita Taveta"))%>%
  pivot_longer(c(limit_sex, using_condoms, hivprevention_knowledge), names_to ="indicators", values_to="values" ) %>%
  mutate(names1=paste0(County,", ", values,"%"))

hivc_men <- full_join(county, hivc[ hivc$Participants%in%"Men_15-24",], by=c("Name"="County"))
hivc_women <- full_join(county, hivc[ hivc$Participants%in%"Women_15-24",], by=c("Name"="County"))
hivc1 <- rbind(hivc_men, hivc_women) %>%
  mutate(Participants=recode(Participants, "Men_15-24"="Men 15-24", "Women_15-24"="Women 15-24"))

#visualization

renderGirafe({
  
  map1<- ggplot(hivc1[hivc1$indicators%in%input$hiv,])+
  geom_sf_interactive(aes(fill=values, tooltip=names1),color="grey80", size=0.0)+
  theme_void()+facet_grid(.~Participants)+
  scale_fill_gradient(low = "white", high = "#8c2d04")+
  labs(x="", y="",fill="Proportion")+
  theme(text=element_text(size=14))
  x <- girafe(ggobj = map1,
                   options = list(
                     opts_hover(css = "fill:#666666;cursor:pointer;"),
                     opts_selection(css = "fill:orange;", type = "multiple"),
                     opts_zoom(max = 4)), width=6, height=3)
    print(x)})


```

<br>

hiv_test {.hidden}
==============================

Inputs {.sidebar}
-----------------------------------

<br>

[Characteristics of Respondents](#respondents_characteristics)</br>

[Health Insurance Coverage](#health_insurance)</br>

[Disability among the household population](#disability_pop)</br>

[Fertility rates](#fertility)</br>

[Teenage pregnancy](#teenage_pregnancy)</br>

[Current use of contraception](#contraception_use)</br>

[Family planning need and demand among married women](#family_planning)</br>

[Maternal care](#maternal_care)</br>

[Vaccinations](#vaccinations)</br>

[Nutritional status](#nutr_status)</br>

[Insecticide treated nets](#treated_nets)</br>

[Knowledge about HIV prevention methods among youth](#hiv_prev)</br>

[Coverage of prior HIV testing](#hiv_test)</br>

[House ownership](#home_ownership)</br>

[Agricultural land ownership](#agric_land_ownership)</br>

[Non-agricultural land ownership](#nonagric_land_ownership)</br>

[Gender based violence](#physical_violence)</br>

## Row {data-width="200"}

<br>

### {.value-box}


```{r}

valueBox(
  value = paste("85%"),
  caption = "of women have ever tested for HIV",
  color = "black"
)

```

### {.value-box}

```{r}
valueBox(
  value = paste("74%"),
  caption = "of men have ever tested for HIV",
  color = "#b15928"
)
```

### {.value-box}

```{r}
valueBox(
  value = paste("47%"),
  caption = "of women have tested for HIV in the last 12 months \n and received results",
  color = "darkgreen"
)
```

### {.value-box}

```{r}
valueBox(
  value = paste("39%"),
  caption = "of men have tested for HIV in the last 12 months \n and received results",
  color = "darkblue"
)
```

<br>

Column {data-height="800"}
---------------------------------

### HIV testing

```{r}

selectInput("hiv_test", "",
              c("Ever tested"="ever_tested",
                "Ever tested and received results"="recieved_results",
                "In the last 12 months, tested & received results"="received_results_last_test",
                "Never tested"="never_tested"))


# import data

hiv_testc <- read_csv("table25C .1 and .2_HIV_test_bind.csv")%>%
  mutate(County=recode(County,"Tharaka-Nithi"="Tharaka Nithi", "Elgeyo/Marakwet"="Elgeyo Marakwet","Murang’a"="Muranga","Nairobi City"="Nairobi","Taita/Taveta"="Taita Taveta"))%>%
  pivot_longer(c(ever_tested, recieved_results,received_results_last_test, never_tested, not_recieve_results ), names_to ="indicators", values_to="values") %>%
  mutate(names1=paste0(County,", ", values,"%")) %>%
  mutate(Participants=str_to_title(Participants))


hiv_testc1 <- full_join(county, hiv_testc, by=c("Name"="County")) 

#visualization

renderGirafe({
  
  map2<- ggplot(hiv_testc1[hiv_testc1$indicators%in%input$hiv_test,])+
  geom_sf_interactive(aes(fill=values, tooltip=names1),color="grey80", size=0.0)+
  theme_void()+facet_grid(.~Participants)+
  scale_fill_gradient(low = "white", high = "#8c2d04")+
  labs(x="", y="",fill="Proportion")+
  theme(text=element_text(size=14))
  x <- girafe(ggobj = map2,
                   options = list(
                     opts_hover(css = "fill:#666666;cursor:pointer;"),
                     opts_selection(css = "fill:orange;", type = "multiple"),
                     opts_zoom(max = 4)), width=6, height=3)
    print(x)})


```

vaccinations {.hidden}
==============================

Inputs {.sidebar}
-----------------------------------

<br>

[Characteristics of Respondents](#respondents_characteristics)</br>

[Health Insurance Coverage](#health_insurance)</br>

[Disability among the household population](#disability_pop)</br>

[Fertility rates](#fertility)</br>

[Teenage pregnancy](#teenage_pregnancy)</br>

[Current use of contraception](#contraception_use)</br>

[Family planning need and demand among married women](#family_planning)</br>

[Maternal care](#maternal_care)</br>

[Vaccinations](#vaccinations)</br>

[Nutritional status](#nutr_status)</br>

[Insecticide treated nets](#treated_nets)</br>

[Knowledge about HIV prevention methods among youth](#hiv_prev)</br>

[Coverage of prior HIV testing](#hiv_test)</br>

[House ownership](#home_ownership)</br>

[Agricultural land ownership](#agric_land_ownership)</br>

[Non-agricultural land ownership](#nonagric_land_ownership)</br>

[Gender based violence](#physical_violence)</br>

## Row {data-width="200"}

<br>

### {.value-box}


```{r}

valueBox(
  value = paste("55%"),
  caption = "of children 12-23 months are fully vaccinated \n according to the national schedule",
  color = "black"
)

```

### {.value-box}

```{r}
valueBox(
  value = paste("38%"),
  caption = "of children 24-35 months are fully vaccinated \n according to the national schedule",
  color = "#b15928"
)
```



<br>

Column {data-height="800"}
---------------------------------

### Fully vaccinated according to the national schedule

```{r}

selectInput("vacc", "",
              c("Fully vaccinated: 12-23 months"="CountyFullyVaccinated12",
                "Fully vaccinated: 24-35 months"="CountyFullyVaccinated24"))


# import data

vacc <- read_csv("table11C_vaccinationbycounty.csv")%>%
  mutate(County=recode(NAME_1,"Tharaka-Nithi"="Tharaka Nithi", "Elgeyo/Marakwet"="Elgeyo Marakwet","Murang’a"="Muranga","Nairobi City"="Nairobi","Taita/Taveta"="Taita Taveta"))%>%
  pivot_longer(c(CountyFullyVaccinated12,CountyFullyVaccinated24 ),names_to ="indicators", values_to="values") %>%
  mutate(names1=paste0(County,", ", values,"%"))


vacc1<- full_join(county, vacc, by=c("Name"="County"))%>%
  mutate(values=as.numeric(parse_number(values)))


#visualization

renderGirafe({
  
  map3<- ggplot(vacc1[vacc1$indicators%in%input$vacc,])+
  geom_sf_interactive(aes(fill=values, tooltip=names1),color="grey80", size=0.0)+
  theme_void()+
  scale_fill_gradient(low = "white", high = "#8c2d04")+
  labs(x="", y="",fill="Proportion")+
  theme(text=element_text(size=14))
  x <- girafe(ggobj = map3, width_svg = 5, height_svg = 5,
                   options = list(
                     opts_hover(css = "fill:#666666;cursor:pointer;"),
                     opts_selection(css = "fill:orange;", type = "multiple"),
                     opts_zoom(max = 4)))
    print(x)})



```


### Characteristics of the fully vaccinated 

```{r}

radioButtons("vacc_char", "",
              c("Sex"="Gender",
                "Birth order"="Birth",
                "Vaccination card"="Card",
                "Residence"="Residence",
                "Mother's education"="Education",
                "Wealth quintile"="Wealth quintile"))




vacc_12_23_gender.1 <- read_csv("table11_vacc_12_23_gender.csv") %>%
  mutate(group="12-23 months") %>%
  mutate(indicator="Gender") %>%
  rename(indicator1=Sex)

vacc_12_23_birth.1 <- read_csv("table11_vacc_12_23_birth.csv") %>%
  mutate(group="12-23 months")  %>%
  mutate(indicator="Birth") %>%
  rename(indicator1=birth.order)

vacc_12_23_card.1 <- read_csv("table11_vacc_12_23_card.csv") %>%
  mutate(group="12-23 months")  %>%
  mutate(indicator="Card") %>%
  rename(indicator1=vacciantion.card)
  
vacc_12_23_residence.1 <- read_csv("table11_vacc_12_23_residence.csv") %>%
  mutate(group="12-23 months")  %>%
  mutate(indicator="Residence") %>%
  rename(indicator1=residence)
  
vacc_12_23_mothers.education.1 <- read_csv("table11_vacc_12_23_mothers.education.csv") %>%
  mutate(group="12-23 months")  %>%
  mutate(indicator="Education") %>%
  rename(indicator1=mothers.education)

vacc_12_23_wealth.quintile.1 <- read_csv("table11_vacc_12_23_wealth.quintile.csv") %>%
  mutate(group="12-23 months")  %>%
  mutate(indicator="Wealth quintile") %>%
  rename(indicator1=wealth.quintile)


vacc_24_35_gender.1 <- read_csv("table11_vacc_24_35_gender.csv") %>%
  mutate(group="24-35 months")  %>%
  mutate(indicator="Gender") %>%
  rename(indicator1=Sex)
  
vacc_24_35_birth.1 <- read_csv("table11_vacc_24_35_birth.csv") %>%
  mutate(group="24-35 months")  %>%
  mutate(indicator="Birth") %>%
  rename(indicator1=birth.order)

vacc_24_35_card.1 <- read_csv("table11_vacc_24_35_card.csv") %>%
  mutate(group="24-35 months")  %>%
  mutate(indicator="Card") %>%
  rename(indicator1=vacciantion.card)

vacc_24_35_residence.1 <- read_csv("table11_vacc_24_35_residence.csv") %>%
  mutate(group="24-35 months") %>%
  mutate(indicator="Residence") %>%
  rename(indicator1=residence)

vacc_24_35_mothers.education.1 <- read_csv("table11_vacc_24_35_mothers.education.csv") %>%
  mutate(group="24-35 months") %>%
  mutate(indicator="Education") %>%
  rename(indicator1=mothers.education)

vacc_24_35_wealth.quintile.1 <- read_csv("table11_vacc_24_35_wealth.quintile.csv") %>%
  mutate(group="24-35 months") %>%
  mutate(indicator="Wealth quintile") %>%
  rename(indicator1=wealth.quintile) 

## join all the data
vaccination_data <- rbind(vacc_12_23_gender.1 , vacc_12_23_birth.1, vacc_12_23_card.1, vacc_12_23_mothers.education.1,vacc_12_23_residence.1, vacc_12_23_wealth.quintile.1, vacc_24_35_gender.1, vacc_24_35_birth.1, vacc_24_35_card.1, vacc_24_35_mothers.education.1, vacc_24_35_gender.1, vacc_24_35_residence.1, vacc_24_35_wealth.quintile.1) %>%
  mutate(group=recode(group, "12-23 months"="CountyFullyVaccinated12", "24-35 months"="CountyFullyVaccinated24"))


renderPlot({
  ggplot(vaccination_data[vaccination_data$indicator%in%input$vacc_char & !is.na(vaccination_data$indicator1) & vaccination_data$group%in%input$vacc,],aes(x=Vaccines, y=Percent)) + 
  geom_bar(stat = "identity", position = position_dodge(), fill="cyan4") +
  theme_bw() +facet_grid(.~indicator1)+
  geom_text(aes(label=Percent), size=5, color="black")+
  scale_fill_brewer(palette = "Set1")+
  coord_flip() + labs(y="Proportion", x="", fill="")+
  theme(strip.text.x = element_text(size = 12, colour = "black", face = "bold")) +
  theme(strip.text.y = element_text(size = 12, colour = "black", face = "bold")) +
  theme(axis.title=element_text(size=14, face="bold"), axis.text = element_text(face = "bold", size = rel(1.5))) +
  theme(strip.background =element_rect(fill="darkorange")) 

}, width=600, height=500)
```

family_planning {.hidden}
==============================

Inputs {.sidebar}
-----------------------------------

<br>

[Characteristics of Respondents](#respondents_characteristics)</br>

[Health Insurance Coverage](#health_insurance)</br>

[Disability among the household population](#disability_pop)</br>

[Fertility rates](#fertility)</br>

[Teenage pregnancy](#teenage_pregnancy)</br>

[Current use of contraception](#contraception_use)</br>

[Family planning need and demand among married women](#family_planning)</br>

[Maternal care](#maternal_care)</br>

[Vaccinations](#vaccinations)</br>

[Nutritional status](#nutr_status)</br>

[Insecticide treated nets](#treated_nets)</br>

[Knowledge about HIV prevention methods among youth](#hiv_prev)</br>

[Coverage of prior HIV testing](#hiv_test)</br>

[House ownership](#home_ownership)</br>

[Agricultural land ownership](#agric_land_ownership)</br>

[Non-agricultural land ownership](#nonagric_land_ownership)</br>

[Gender based violence](#physical_violence)</br>

## Row {data-width="200"}

<br>

### {.value-box}


```{r}

valueBox(
  value = paste("76%"),
  caption = "is the demand for family planning among married women",
  color = "black"
)

```

### {.value-box}

```{r}
valueBox(
  value = paste("14%"),
  caption = "of married women have an unmet need for family planning",
  color = "#b15928"
)
```

### {.value-box}

```{r}
valueBox(
  value = paste("82%"),
  caption = "of married women have satisfied demand for family planning",
  color = "darkgreen"
)
```



<br>

Row {data-height="200"}
---------------------------------

### Family planning

```{r}

radioButtons("fp_demand", "",
              c("Total demand"="Total demand",
                "Met need (all methods)"="Met need (all methods)",
                "Demand satisfied (all methods)"="Demand satisfied (all methods)",
                "Unmet need"="Unmet need"))

```

Column {data-height="800"}
---------------------------------
### Spatial visualization

```{r}
# import data

needdemandforfpusemarriedbycountyvisual <- read_csv("table9c_needdemandforfpusemarriedbycounty.csv") %>%
  mutate(County=recode(County,"Tharaka-Nithi"="Tharaka Nithi", "Elgeyo/Marakwet"="Elgeyo Marakwet","Murang’a"="Muranga","Nairobi City"="Nairobi","Taita/Taveta"="Taita Taveta")) %>%
  mutate(names1=paste0(County,", ", Percent,"%"))

# join the data with the shapefile
needdemandforfpusemarriedbycountyvisual1 <- left_join(county, needdemandforfpusemarriedbycountyvisual, by=c("Name"="County"))

renderGirafe({
  
  map3<- ggplot(needdemandforfpusemarriedbycountyvisual1[needdemandforfpusemarriedbycountyvisual1$Family_planning%in%input$fp_demand,])+
  geom_sf_interactive(aes(fill=Percent, tooltip=names1),color="grey80", size=0.0)+
  theme_void()+
  scale_fill_gradient(low = "white", high = "#8c2d04")+
  labs(x="", y="",fill="Proportion")+
  theme(text=element_text(size=14))
  x <- girafe(ggobj = map3,
                   options = list(
                     opts_hover(css = "fill:#666666;cursor:pointer;"),
                     opts_selection(css = "fill:orange;", type = "multiple"),
                     opts_zoom(max = 4)), width=8, height=7)
    print(x)})

```

### Family planning data in descending order

```{r}

renderPlot({
  ggplot(needdemandforfpusemarriedbycountyvisual1[needdemandforfpusemarriedbycountyvisual1$Family_planning%in%input$fp_demand,], aes(x=reorder(Name, Percent), y=Percent)) +
geom_bar(stat = "identity", position = position_dodge(), fill="cyan4") +
  theme_bw() + coord_flip() +
  geom_text(aes(label=Percent), hjust=1.3, size=5, color="white")+
  coord_flip() + 
  ylab("Weighted percent") + xlab("County") +
  facet_grid(~Family_planning) +
  theme(strip.text.x = element_text(size = 12, colour = "black", face = "bold")) +
  theme(strip.text.y = element_text(size = 12, colour = "black", face = "bold")) +
  theme(axis.title=element_text(size=14, face="bold"), axis.text = element_text(face = "bold", size = rel(1.5))) +
  theme(strip.background =element_rect(fill="darkorange")) 
})

```

Compare trends over time
============



## Row {data-width="200"}
--------------------------

### Trends on:


```{r}

radioButtons("trends", "",
             c("Fertility by residence"= "fertility",
             "Need for, and demand for family planning"="family_planning",
             "Delivery assistance"="delivery",
             "Childhood vaccinations"="vaccinations",
             "Children nutritional status"="nutrition",
             "Exclusive breastfeeding"="breastfeeding",
             "Incidence of Childhood mortality (per 1000)"="mortality",
             "Household possession of insecticide treated nets"="treated_nets"))

```

<br>

Row {data.width="600"}
--------------------------

#### Trends over time

```{r, fig.width=16, fig.height=10}
# fertility rate
trendstotalfertilityrate <- read_csv("figure1_trendstotalfertilityrate.csv") %>%
  rename(grouping=Residence,
         Percent=`Total Fertility Rate`) %>%
  mutate(indicator="fertility")
 
# family planning
trendsinfusevisual <- read_csv("figure2_trendsinfpuse.csv") %>%
  rename(grouping=`Family planning`) %>%
  mutate(indicator="family_planning")

# skilled deliveries
trendsdeliveryassistance <- read_csv("figure3_trendsdeliveryassistance.csv") %>%
  mutate(grouping="Delivery") %>%
  rename(Percent=Proportion) %>%
  mutate(indicator="delivery")

# Child vaccinations
trendschildvaccinations <- read_csv("figure4_trendschildvaccines.csv") %>%
  rename(grouping=`Vaccination status`) %>%
  mutate(indicator="vaccinations")

# Child nutrition
trendschildnutrition <- read_csv("figure6_trendschildnutrition.csv") %>%
   rename(grouping=`Nutrition measure`) %>%
  mutate(indicator="nutrition")

# exclusive breastfeeding
trendsexclusivebreastfed <- read_csv("figure7_trendsexclusivebreastfed.csv") %>%
  rename(Percent=Proportion) %>%
  mutate(indicator="breastfeeding",
         grouping="Exclusive breastfeeding")
 
# child mortality
trendschildmortality <- read_csv("figure8_trendschildmortality.csv") %>%
  rename(grouping=Category,
         Percent=n_per1000) %>%
  mutate(indicator="mortality")
  
# insecticide treated nets
trendsitn <- read_csv("figure9_trendsitn.csv") %>%
  rename(grouping=Category) %>%
  mutate(indicator="treated_nets")
  

# combine data
trends_data <- rbind(trendstotalfertilityrate, trendsinfusevisual, trendsdeliveryassistance, trendschildvaccinations, trendschildnutrition, trendsexclusivebreastfed,trendschildmortality, trendsitn ) %>%
  filter(!grouping%in%"Total") %>%
  filter(!Years==1999)

renderGirafe({
  trends_map <-trends_data %>%filter(indicator%in%input$trends)%>%
  ggplot(aes(x=Years, y=Percent, color=grouping)) + 
  geom_smooth( size= 2.5 ) +
  theme_bw() + 
  geom_point_interactive(size = 2.0, aes(tooltip=Percent)) +
  labs(x="Kenya DHS Years", y=unique(input$trends),color="") +
  theme(text =element_text(size=18, face="bold"))
  trends_map2<-girafe(ggobj =  trends_map,
                   options = list(
                     opts_hover(css = "fill:#666666;cursor:pointer;"),
                     opts_selection(css = "fill:orange;", type = "multiple"),
                     opts_zoom(max = 9)),  height=4, width=6)
  print( trends_map2)
  
})

```






Compare indicators by county
============


```{r}

### datasets


#nutrition
nutc <- read_csv("table14C_nutr_status_by_county.csv")%>%
  mutate(County=recode(County,"Tharaka-Nithi"="Tharaka Nithi", "Elgeyo/Marakwet"="Elgeyo Marakwet","Murang’a"="Muranga","Nairobi City"="Nairobi","Taita/Taveta"="Taita Taveta")) %>%
  pivot_longer(c(perc_below3sd, perc_below2sd), names_to="indicator1", values_to="values") %>%
  mutate(indicator1=paste0(indicator,"_",indicator1)) %>%
  select(County, indicator, indicator1, values)

#Insecticide treated nets
itnc <- read_csv("table18C_ITN_by_county.csv")%>%
  mutate(County=recode(County,"Tharaka-Nithi"="Tharaka Nithi", "Elgeyo/Marakwet"="Elgeyo Marakwet","Murang’a"="Muranga","Nairobi City"="Nairobi","Taita/Taveta"="Taita Taveta")) %>%
  pivot_longer(c(perc_atleast_1itn,avrg_itn_hh, perc_atleast_1itn_2pple, no_hhs_1person_overnight), names_to="indicator1", values_to="values") %>%
  mutate(indicator="Insecticide treated nets") %>%
  select(County, indicator, indicator1, values)

#family planning
fpc <- read_csv("table8c_fpusemarriedbycounty.csv")%>%
  mutate(County=recode(County,"Tharaka-Nithi"="Tharaka Nithi", "Elgeyo/Marakwet"="Elgeyo Marakwet","Murang’a"="Muranga","Nairobi City"="Nairobi","Taita/Taveta"="Taita Taveta")) %>%
  pivot_longer(c(2:15), names_to="indicator1", values_to="values") %>%
  mutate(indicator="Family planning") %>%
  select(County, indicator, indicator1, values)

#teenage pregnancy
teenpregc <- read_csv("table6_teenpregnancybycounty.csv")%>%
  mutate(County=recode(County,"Tharaka-Nithi"="Tharaka Nithi", "Elgeyo/Marakwet"="Elgeyo Marakwet","Murang’a"="Muranga","Nairobi City"="Nairobi","Taita/Taveta"="Taita Taveta")) %>%
  pivot_longer(c(2:5), names_to="indicator1", values_to="values") %>%
  mutate(indicator="Teenage Pregnancy") %>%
  select(County, indicator, indicator1, values)

#violence
violencec <- read_csv("table_29C_Women.csv")%>% 
  rename(County=`Background characteristic`)%>%
  mutate(County=recode(County,"Tharaka-Nithi"="Tharaka Nithi", "Elgeyo/Marakwet"="Elgeyo Marakwet","Murang’a"="Muranga","Nairobi City"="Nairobi","Taita/Taveta"="Taita Taveta"))%>%
  filter(!County%in%c("Total",NA)) %>%
  pivot_longer(c(2:5), names_to="indicator1", values_to="values") %>%
  mutate(indicator="Violence") %>%
  select(County, indicator, indicator1, values)

#maternal care  
matcarec <- read_csv("table10c_maternalcarebycounty.csv")%>% 
  mutate(County=recode(County,"Tharaka-Nithi"="Tharaka Nithi", "Elgeyo/Marakwet"="Elgeyo Marakwet","Murang’a"="Muranga","Nairobi City"="Nairobi","Taita/Taveta"="Taita Taveta")) %>%
  rename(indicator1=`Maternal care`,
         values=Percent) %>%
  mutate(indicator="Maternal Care") %>%
  select(County, indicator, indicator1, values)

#vaccination 
vacc <- read_csv("table11C_vaccinationbycounty.csv")%>%
  mutate(County=recode(NAME_1,"Tharaka-Nithi"="Tharaka Nithi", "Elgeyo/Marakwet"="Elgeyo Marakwet","Murang’a"="Muranga","Nairobi City"="Nairobi","Taita/Taveta"="Taita Taveta")) %>%
  pivot_longer(c(2:3), names_to="indicator1", values_to="values") %>%
  mutate(indicator="Child Vaccinations") %>%
  select(County, indicator, indicator1, values)

#hiv knowledge
hivc_men <- read_csv("table23_hiv_count_data.csv")%>% 
  #rename(County=`NAME_1`)%>%
  mutate(County=recode(County,"Tharaka-Nithi"="Tharaka Nithi", "Elgeyo/Marakwet"="Elgeyo Marakwet","Murang’a"="Muranga","Nairobi City"="Nairobi","Taita/Taveta"="Taita Taveta")) %>%
  pivot_longer(c(2:4), names_to="indicator1", values_to="values") %>%
  mutate(indicator="HIV knowledge: Men (15-24)") %>%
  mutate(indicator1=paste0("men_",indicator1)) %>%
  select(County, indicator, indicator1, values)

hivc_women <- read_csv("table23_hiv_count_data.csv")%>% 
  #rename(County=`NAME_1`)%>%
  mutate(County=recode(County,"Tharaka-Nithi"="Tharaka Nithi", "Elgeyo/Marakwet"="Elgeyo Marakwet","Murang’a"="Muranga","Nairobi City"="Nairobi","Taita/Taveta"="Taita Taveta")) %>%
  pivot_longer(c(2:4), names_to="indicator1", values_to="values") %>%
  filter(Participants%in%"Women_15-24") %>%
  mutate(indicator1=paste0("women_",indicator1)) %>%
  mutate(indicator="HIV knowledge: Women (15-24)") %>%
  select(County, indicator, indicator1, values) 

#hiv testing
hiv_testc_men <- read_csv("table25C .1 and .2_HIV_test_bind.csv")%>% 
  #rename(County=`NAME_1`)%>%
  mutate(County=recode(County,"Tharaka-Nithi"="Tharaka Nithi", "Elgeyo/Marakwet"="Elgeyo Marakwet","Murang’a"="Muranga","Nairobi City"="Nairobi","Taita/Taveta"="Taita Taveta")) %>%
  pivot_longer(c(2:4, 6,7), names_to="indicator1", values_to="values") %>%
  filter(Participants%in%"men") %>%
  mutate(indicator1=paste0("men_",indicator1)) %>%
  mutate(indicator="HIV testing: Men") %>%
  select(County, indicator, indicator1, values) 

hiv_testc_women <- read_csv("table25C .1 and .2_HIV_test_bind.csv")%>% 
  #rename(County=`NAME_1`)%>%
  mutate(County=recode(County,"Tharaka-Nithi"="Tharaka Nithi", "Elgeyo/Marakwet"="Elgeyo Marakwet","Murang’a"="Muranga","Nairobi City"="Nairobi","Taita/Taveta"="Taita Taveta")) %>%
  pivot_longer(c(2:4, 6,7), names_to="indicator1", values_to="values") %>%
  filter(Participants%in%"Women") %>%
  mutate(indicator1=paste0("women_",indicator1)) %>%
  mutate(indicator="HIV testing: Women") %>%
  select(County, indicator, indicator1, values)

## combine datasets
combined_data <- rbind(nutc, itnc,fpc,teenpregc,
                              violencec, matcarec, vacc, hivc_men, hivc_women, hiv_testc_men, hiv_testc_women ) %>%
  mutate(values=as.numeric(parse_number(values))) 
```

Row {data-width="800"}
---------------------------------



#### Choose indicators to compare: Indicator 1

```{r}
selectInput("comp_indicator1", "",
              c("Child immunization: Fully Vaccinated (12-23 months)"="CountyFullyVaccinated12",
                "Child immunization: Fully Vaccinated (24-35 months)"="CountyFullyVaccinated24",
                "Current contraceptive use: Any method"="Contraceptive_use_any_method",
                "Current contraceptive use: Modern method"="Contraceptive_use_modern_method",
                "Family planning method: Emergency contraception"="Emergency_contraception",
                "Family planning method: Female condom"="Female_condom",
                "Family planning method: Standard Days Method"="SDM",
                "Family planning method: Female sterilization"  ="Female_sterilization",
                "Family planning method: Implants"="Implants", 
                "Family planning method: Injectables"="Injectables",
                "Family planning method: IUD"="IUD",
                "Family planning method: Pill"="Pill",
                "Family planning method: LAM"="LAM",
                "Family planning method: Other"="Other",
                "Family planning method: Male condom"="Male_condom",
                "Family planning method: Male sterilization"="Male_sterilization",
                "HIV prevention knowledge (men)"="men_hivprevention_knowledge",
                "HIV prevention (men): Limit sex to one partner"="men_limit_sex",
                "HIV prevention (men): Using condoms"="men_using_condoms",
                "HIV prevention knowledge (women)"="women_hivprevention_knowledge",
                "HIV prevention (women): Limit sex to one partner"="women_limit_sex",
                 "HIV prevention (women): Using condoms"="women_using_condoms",
                "HIV testing (Men): Has ever tested"="men_ever_tested",
                "HIV testing (Men): Has never tested"="men_never_tested",
                "HIV testing (Men): Tested but not received results"="men_not_recieve_results",
                "HIV testing (Men): Tested & received results"="men_recieved_results",
                "HIV testing (Men): Tested in last 12 months & received results"="men_received_results_last_test",
                "HIV testing (women): Has ever tested"="women_ever_tested",
                "HIV testing (Men): Has never tested"="women_never_tested",
                "HIV testing (Men): Tested but not received results"="women_not_recieve_results",
                "HIV testing (Men): Tested & received results"="women_recieved_results",
                "HIV testing (Men): Tested in last 12 months & received results"="women_received_results_last_test",
                "Insecticide treated nets: average no. in households"="avrg_itn_hh",
                "Insecticide treated nets: at least 1 in a household"="perc_atleast_1itn",
                "Maternal care: ANC from a skilled provider"="ANC from a skilled provider",
                "Maternal care: At least four ANC visits"="At least four ANC visits",
                "Maternal care: Skilled delivery"="Skilled delivery",
                "Maternal care: Health facility delivery"="Health facility delivery",
                "Maternal care: Protection against neonatal tetanus"="Neonatal tetanus",
                "Maternal care: Postnatal check during first 2 days after birth"="Postnatal check",
                "Maternal care: Took iron-containing supplements during pregnancy"="Took iron supplements",
                "Nutrition: Moderate stunting"="HFA_perc_below2sd",
                "Nutrition: Severe stunting"="HFA_perc_below3sd",
                "Nutrition: Moderate wasting"=" WFA_perc_below2sd",
                "Nutrition: Severe wasting"=" WFA_perc_below3sd",
                "Nutrition: Moderate underweight"=" WFH_perc_below2sd",
                "Nutrition: Severe underweight"=" WFH_perc_below3sd",
                "Gender based violence (Women): Often"="Often",
                "Gender based violence (Women): Sometimes"="Sometimes",
                "Gender based violence (Women): Ever experienced violence (from age 15)"="Percentage who have experienced physical violence since age 15",
                "Teenager: currently pregnant"="Currently_pregnant",
                "Teenager: ever been pregnant"="Ever_pregnant",
                "Teenager: ever had pregnancy loss"="Pregnancy_loss",
                "Teenage pregnancy: Live births"="Live_birth"
                ), width = 300)
```

<br>

<br>

##### Choose indicator 2

```{r}

selectInput("comp_indicator2", "",
              c("Child immunization: Fully Vaccinated (12-23 months)"="CountyFullyVaccinated12",
                "Child immunization: Fully Vaccinated (24-35 months)"="CountyFullyVaccinated24",
                "Current contraceptive use: Any method"="Contraceptive_use_any_method",
                "Current contraceptive use: Modern method"="Contraceptive_use_modern_method",
                "Family planning method: Emergency contraception"="Emergency_contraception",
                "Family planning method: Female condom"="Female_condom",
                "Family planning method: Standard Days Method"="SDM",
                "Family planning method: Female sterilization"  ="Female_sterilization",
                "Family planning method: Implants"="Implants", 
                "Family planning method: Injectables"="Injectables",
                "Family planning method: IUD"="IUD",
                "Family planning method: Pill"="Pill",
                "Family planning method: LAM"="LAM",
                "Family planning method: Other"="Other",
                "Family planning method: Male condom"="Male_condom",
                "Family planning method: Male sterilization"="Male_sterilization",
                "HIV prevention knowledge (men)"="men_hivprevention_knowledge",
                "HIV prevention (men): Limit sex to one partner"="men_limit_sex",
                "HIV prevention (men): Using condoms"="men_using_condoms",
                "HIV prevention knowledge (women)"="women_hivprevention_knowledge",
                "HIV prevention (women): Limit sex to one partner"="women_limit_sex",
                 "HIV prevention (women): Using condoms"="women_using_condoms",
                "HIV testing (Men): Has ever tested"="men_ever_tested",
                "HIV testing (Men): Has never tested"="men_never_tested",
                "HIV testing (Men): Tested but not received results"="men_not_recieve_results",
                "HIV testing (Men): Tested & received results"="men_recieved_results",
                "HIV testing (Men): Tested in last 12 months & received results"="men_received_results_last_test",
                "HIV testing (women): Has ever tested"="women_ever_tested",
                "HIV testing (Men): Has never tested"="women_never_tested",
                "HIV testing (Men): Tested but not received results"="women_not_recieve_results",
                "HIV testing (Men): Tested & received results"="women_recieved_results",
                "HIV testing (Men): Tested in last 12 months & received results"="women_received_results_last_test",
                "Insecticide treated nets: average no. in households"="avrg_itn_hh",
                "Insecticide treated nets: at least 1 in a household"="perc_atleast_1itn",
                "Maternal care: ANC from a skilled provider"="ANC from a skilled provider",
                "Maternal care: At least four ANC visits"="At least four ANC visits",
                "Maternal care: Skilled delivery"="Skilled delivery",
                "Maternal care: Health facility delivery"="Health facility delivery",
                "Maternal care: Protection against neonatal tetanus"="Neonatal tetanus",
                "Maternal care: Postnatal check during first 2 days after birth"="Postnatal check",
                "Maternal care: Took iron-containing supplements during pregnancy"="Took iron supplements",
                "Nutrition: Moderate stunting"="HFA_perc_below2sd",
                "Nutrition: Severe stunting"="HFA_perc_below3sd",
                "Nutrition: Moderate wasting"=" WFA_perc_below2sd",
                "Nutrition: Severe wasting"=" WFA_perc_below3sd",
                "Nutrition: Moderate underweight"=" WFH_perc_below2sd",
                "Nutrition: Severe underweight"=" WFH_perc_below3sd",
                "Gender based violence (Women): Often"="Often",
                "Gender based violence (Women): Sometimes"="Sometimes",
                "Gender based violence (Women): Ever experienced violence (from age 15)"="Percentage who have experienced physical violence since age 15",
                "Teenager: currently pregnant"="Currently_pregnant",
                "Teenager: ever been pregnant"="Ever_pregnant",
                "Teenager: ever had pregnancy loss"="Pregnancy_loss",
                "Teenage pregnancy: Live births"="Live_birth"
                ), width = 300)
```

<br>

<br>



### Comparison by indicators 

```{r, fig.width=12,fig.height=22}


renderGirafe({
  combined_data1<- left_join(combined_data[combined_data$indicator1%in%input$comp_indicator1,]%>%select(-indicator), combined_data[combined_data$indicator1%in%input$comp_indicator2, ]%>%rename(indicator2=indicator1, values2=values)%>%select(-indicator))
  combined_map<- ggplot(combined_data1, aes(x=values, y=values2))+
  geom_point_interactive(size=4, aes(tooltip=County), color="cyan")+
  theme_bw()+
  labs(y=paste0(unique(combined_data1$indicator2)), title="", x=paste0(unique(combined_data1$indicator1)), fill="")+
  #scale_fill_manual(values = c("#f46d43","#fee090","#4575b4"))+
  theme(text=element_text(size=18), legend.position = "none")
  
   combined_map2<-girafe(ggobj =  combined_map,
                   options = list(
                     opts_hover(css = "fill:#666666;cursor:pointer;"),
                     opts_selection(css = "fill:orange;", type = "multiple"),
                     opts_zoom(max = 4)), width=20, height=8)
  print( combined_map2)
})

#paste0(input$comp)
#paste0(input$comp1)
```



# About

The App uses data from the Key Indicators Report of the 2022 Kenya Demographic and Health Survey (2022 KDHS). The survey was implemented by the Kenya National Bureau of Statistics (KNBS) in collaboration with the Kenya's Ministry of Health (MoH) and other stakeholders.

It provides easy-to-use interface to explore 2022 KDHS data using tools such as choropleth maps, bar plots, trend plots. This is a living app that is continuously developed to include comparisons of the current results with those from Demographic and Health Surveys.

Recommended citation of the report from which the data is drawn from:

KNBS and ICF. 2022. Kenya Demographic and Health Survey 2022. Key Indicators Report. Nairobi, Kenya, and Rockville, Maryland, USA: KNBS and ICF.

The analytics and visualizations are created with the support of the *Center for Epidemiological Modelling and Analysis* (CEMA) at the University of Nairobi, Kenya.



