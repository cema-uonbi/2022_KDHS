full_final_dataset2x<-full_join(full_final_dataset2w,c_data1, by=c("date", "county"))
full_final_dataset2x<-distinct(ungroup(full_final_dataset2x%>%
mutate(county=trimws(county))%>%
dplyr::mutate(county=dplyr::recode(county, "Muranga"="Murang'a", "Homabay"="Homa Bay", "Taita-Taveta"="Taita Taveta", "Akuh"="Nairobi", "Nyadarua"="Nyandarua", "Pumwani Maternity"="Nairobi", "Mbagathi Hospital"="Nairobi", "Nairobi Womens Hospital"="Nairobi", "Ngewa Health Centre-Kiambu"="Kiambu", "Tharaka nithi"="Tharaka Nithi", "Trans nzoia"="Trans Nzoia" ))%>%
dplyr::group_by(county, date)%>%
mutate(admissions=sum(admissions.x, admissions.y, na.rm=T))%>%
mutate(new_admissions=sum(new_admissions.x, new_admissions.y, na.rm=T))%>%
mutate(icu=sum(icu.x, icu.y, na.rm=T))%>%
mutate(oxygen=sum(oxygen.x, oxygen.y, na.rm=T))%>%
mutate(new_discharges=sum(new_discharges.x, new_discharges.y, na.rm=T)))%>%
select(county,date,admissions, new_admissions, icu, oxygen, new_discharges))
table(full_final_dataset2x$county)
c_data1<-distinct(ungroup(c_data%>%
dplyr::mutate(county=str_remove(str_to_title(county), "County"))%>%
dplyr::filter(!(county%in%c("Counts","Totals","Total")))%>%
dplyr::mutate(county=trimws(county))%>%
dplyr::mutate(county=ifelse(county%in%c("Nairobi (Nms)","Nms", "Mp Shah", "Kutrrh","Knh","Avenue Group","Aga Khan University Hospital Nairobi", "The Nairobi Hospital","Nairobi", "Mater Hospital", "Nairobi Hospital", "Akuh", "Karen Hospital", "Al- Amin Hospital", "Coptic Hospital", "Care Hospital", "Kibera South", "Komarock Modern Health Care", "Madina Hopital", "Meridian Hospital", "Metropolitan Hospital", "Mlkh", "Nairob South Hospital", "Nairobi West Hospital", "St. Francis Comm Hopspital", "St. Francis Comm Hospital", "Radiant Hospitals- Sportsview", "Mgagathi Hospital", "Mama Lucy Kh","Mbagathi Hospital","Pumwani Maternity"),"Nairobi", county))%>%
mutate(county=recode(county, "Nakuru ."="Nakuru", "Mtrh"="Uasin Gishu", "Trans Nzioa"="Trans Nzoia", "Akuh"="Nairobi", "Embu ."="Embu", "Isiolo ."="Isiolo", "Kitui ."="Kitui", "Machakos ."="Machakos", "Makueni ."="Makueni", "Marsabit ."="Marsabit", "Meru ."="Meru", "Narok ."="Narok", "Samburu ."="Samburu", "Tharaka Nithi ."="Tharaka Nithi", "Nyadarua"="Nyandarua", "Nms Total"="Nairobi"))%>%
# mutate(date=recode(date, "x1_04_21"="x01_04_2021"))%>%
mutate(date=str_sub(date,2,-1))%>%
mutate(date=dmy(date))%>%
filter(!is.na(county))%>%
group_by(county, date)%>%
mutate(admissions=sum(as.numeric(covid_19_cumulative_no_of_admissions_up_to_previous_update), na.rm = T))%>%
mutate(new_admissions=sum(as.numeric(no_of_new_admissions_in_the_last_24_hrs), na.rm=T))%>%
mutate(icu=sum(as.numeric(no_of_covid_19_patients_on_observation_in_icu), as.numeric(no_of_covid_19_patients_on_supplementary_oxygen_in_icu), as.numeric(no_of_covid_19_patients_on_ventilators), na.rm=T))%>%
dplyr::mutate(oxygen=sum(as.numeric(no_of_covid_19_patients_on_supplementary_oxygen_in_general_wards),as.numeric(no_of_covid_19_patients_on_supplementary_oxygen_in_icu), as.numeric(no_of_covid_19_patients_on_supplementary_oxygen_in_hdu), na.rm=T))%>%
mutate(new_discharges=sum(as.numeric(no_of_new_facility_discharges), na.rm=T))%>%
select(county, date, admissions, new_admissions, icu, oxygen, new_discharges)))
full_final_dataset2x<-full_join(full_final_dataset2w,c_data1, by=c("date", "county"))
full_final_dataset2x<-distinct(ungroup(full_final_dataset2x%>%
mutate(county=trimws(county))%>%
dplyr::mutate(county=dplyr::recode(county, "Muranga"="Murang'a", "Homabay"="Homa Bay", "Taita-Taveta"="Taita Taveta", "Akuh"="Nairobi", "Nyadarua"="Nyandarua", "Pumwani Maternity"="Nairobi", "Mbagathi Hospital"="Nairobi", "Nairobi Womens Hospital"="Nairobi", "Ngewa Health Centre-Kiambu"="Kiambu", "Tharaka nithi"="Tharaka Nithi", "Trans nzoia"="Trans Nzoia", "Nms Total"="Nairobi" ))%>%
dplyr::group_by(county, date)%>%
mutate(admissions=sum(admissions.x, admissions.y, na.rm=T))%>%
mutate(new_admissions=sum(new_admissions.x, new_admissions.y, na.rm=T))%>%
mutate(icu=sum(icu.x, icu.y, na.rm=T))%>%
mutate(oxygen=sum(oxygen.x, oxygen.y, na.rm=T))%>%
mutate(new_discharges=sum(new_discharges.x, new_discharges.y, na.rm=T)))%>%
select(county,date,admissions, new_admissions, icu, oxygen, new_discharges))
table(full_final_dataset2x$county)
write_csv(full_final_dataset2x, "admissions_summary_20221109.csv")
#------------------ Packages ------------------
knitr::opts_chunk$set(echo = FALSE)
library(tidyverse)
library(EpiEstim)
library(incidence)
library(deSolve)
library(lubridate)
library(plotly)
library(dplyr)
library(reshape)
library(htmltools)
library(magrittr)
library(stringr)
library(tibble)
library(readxl)
library(lubridate)
library(rgdal)
library(sf)
library(gghighlight)
library(magrittr)
library(plotly)
library(janitor)
#library(broom)
#library(hrbrthemes)
library(rvest)
library(gt)
library(deSolve)
library(distcrete)
library(epitrix)
library(projections)
library(earlyR)
library(flexdashboard)
#library(squire)
#install.packages("devtools")
#devtools::install_github("RamiKrispin/coronavirus", force = TRUE)
#install.packages("coronavirus")
library(coronavirus)
data(coronavirus)
#update_dataset()
#View(coronavirus)
#max(coronavirus$date)
`%>%` <- magrittr::`%>%`
#------------------ Parameters ------------------
# Set colors
# https://www.w3.org/TR/css-color-3/#svg-color
confirmed_color <- "black"
active_color <- "#1f77b4"
recovered_color <- "forestgreen"
death_color <- "red"
#------------------ Data ------------------
df <- coronavirus %>%
dplyr::filter(date >= "2020-03-12") %>%
dplyr::filter(country == "Kenya") %>%
dplyr::group_by(country, type) %>%
dplyr::summarise(total = sum(cases)) %>%
tidyr::pivot_wider(
names_from = type,
values_from = total
) %>%
# dplyr::mutate(unrecovered = confirmed - ifelse(is.na(recovered), 0, recovered) - ifelse(is.na(death), 0, death)) %>%
dplyr::mutate(unrecovered = confirmed - ifelse(is.na(death), 0, death)) %>%
dplyr::arrange(-confirmed) %>%
dplyr::ungroup() %>%
dplyr::mutate(country = dplyr::if_else(country == "United Arab Emirates", "UAE", country)) %>%
dplyr::mutate(country = dplyr::if_else(country == "Mainland China", "China", country)) %>%
dplyr::mutate(country = dplyr::if_else(country == "North Macedonia", "N.Macedonia", country)) %>%
dplyr::mutate(country = trimws(country)) %>%
dplyr::mutate(country = factor(country, levels = country))
#worlddatacovid <- read_csv("https://covid.ourworldindata.org/data/owid-covid-data.csv") # data from ourworlddata
#ecdccovid <- read_csv("https://opendata.ecdc.europa.eu/covid19/casedistribution/csv", na.strings = "", fileEncoding = "UTF-8-BOM")
#humdatacovid <- read_csv("https://datahub.io/core/covid-19/r/time-series-19-covid-combined.csv")
# df_daily <- humdatacovid %>%
#   dplyr::filter(Date >= "2020-03-12") %>%
#   dplyr::filter(`Country/Region` == "Kenya") %>%
#   #dplyr::group_by(Date) %>%
#   dplyr::mutate(
#     confirmed_cum = cumsum(Confirmed),
#     recovered_cum = cumsum(Recovered),
#     death_cum = cumsum(Deaths),
#     active = (confirmed_cum - death_cum - recovered_cum),
#     active_cum = cumsum(active)) %>%
#   dplyr::ungroup()
df_daily <- coronavirus %>%
dplyr::filter(date >= "2020-03-10") %>%
dplyr::filter(country == "Kenya") %>%
dplyr::group_by(date, type) %>%
dplyr::summarise(total = sum(cases, na.rm = TRUE)) %>%
tidyr::pivot_wider(
names_from = type,
values_from = total
) %>%
dplyr::arrange(date) %>%
dplyr::ungroup() %>%
#dplyr::mutate(active = confirmed - death - recovered) %>%
dplyr::mutate(active = confirmed - death) %>%
dplyr::mutate(recovery1=active - dplyr::lag(active))%>%
dplyr::mutate(recovery1=ifelse(is.na(recovery1), 0, recovery1))%>%
dplyr::mutate(
confirmed_cum = cumsum(confirmed),
recovered_cum = cumsum(recovery),
death_cum = cumsum(death),
active_cum = cumsum(active),
recovered1_cum=cumsum(abs(recovery1))
)%>%
mutate(recovered_cum=ifelse(date>as.Date("2021-08-04"), (119277+recovered1_cum), recovered_cum))
#df1 <- coronavirus %>% dplyr::filter(date == max(date))
# kecovidcases <- read_csv("kecovidincidence.csv") %>%
#   dplyr::mutate(Dates = as.Date(Dates, "%d/%m/%Y")) %>%
#   filter(Dates<="2020-05-13")
#
# datetoday <- today()-1
# cases <- sum(kecovidcases$Incidence)
df <- coronavirus %>%
dplyr::filter(date >= "2020-03-12") %>%
dplyr::filter(country == "Kenya") %>%
dplyr::group_by(country, type) %>%
dplyr::summarise(total = sum(cases)) %>%
tidyr::pivot_wider(
names_from = type,
values_from = total
) %>%
# dplyr::mutate(unrecovered = confirmed - ifelse(is.na(recovered), 0, recovered) - ifelse(is.na(death), 0, death)) %>%
dplyr::mutate(unrecovered = confirmed - ifelse(is.na(death), 0, death)) %>%
dplyr::arrange(-confirmed) %>%
dplyr::ungroup() %>%
dplyr::mutate(country = dplyr::if_else(country == "United Arab Emirates", "UAE", country)) %>%
dplyr::mutate(country = dplyr::if_else(country == "Mainland China", "China", country)) %>%
dplyr::mutate(country = dplyr::if_else(country == "North Macedonia", "N.Macedonia", country)) %>%
dplyr::mutate(country = trimws(country)) %>%
dplyr::mutate(country = factor(country, levels = country))
df_daily <- coronavirus %>%
dplyr::filter(date >= "2020-03-13") %>%
dplyr::filter(country == "Kenya") %>%
dplyr::group_by(date, type) %>%
dplyr::summarise(total = sum(cases, na.rm = TRUE)) %>%
tidyr::pivot_wider(
names_from = type,
values_from = total
) %>%
dplyr::arrange(date) %>%
dplyr::ungroup() %>%
#dplyr::mutate(active = confirmed - death - recovered) %>%
dplyr::mutate(active = confirmed - death) %>%
dplyr::mutate(
confirmed_cum = cumsum(confirmed),
recovered_cum = cumsum(recovery),
death_cum = cumsum(death),
active_cum = cumsum(active)
)%>%
dplyr::mutate(recovered_cum= ifelse(date>as.Date("2021-08-04"), 191188,recovered_cum))
Tme <- nrow(df_daily)
t_start <- seq(2, Tme-35) # starting at 2 as conditional on the past observations
t_end <- t_start + 35 # adding 6 to get 7-day windows as bounds included in window
res_biweekly <- estimate_R(df_daily$confirmed,
method="parametric_si",
config = make_config(list(
t_start = t_start,
t_end = t_end,
mean_si = 4.8,
std_si = 2.3))
)
estimatedReff <- plot(res_biweekly, "R", color="red") + theme_bw() + labs(x="Time") +
ggplot2::scale_x_continuous(breaks=c(seq(1,tail(res_biweekly$dates,1), by=56)),labels=substr(seq.Date(as.Date("2020-03-10"), today(), by="8 weeks"),1,7))+theme(axis.text = element_text(face="bold", color="black", size=13))
res_biweekly$dates
c(seq(1,tail(res_biweekly$dates,1), by=56))
seq.Date(as.Date("2020-03-10"), today(), by="8 weeks"),1,7))
seq.Date(as.Date("2020-03-10"), today(), by="8 weeks")
tail(res_biweekly$dates,1)
8*7
c(seq(1,tail(res_biweekly$dates,1), by=49)
)
estimatedReff <- plot(res_biweekly, "R", color="red") + theme_bw() + labs(x="Time") +
ggplot2::scale_x_continuous(breaks=c(seq(1,tail(res_biweekly$dates,1), by=49)),labels=substr(seq.Date(as.Date("2020-03-10"), today()-1, by="8 weeks"),1,7))+theme(axis.text = element_text(face="bold", color="black", size=13))
seq.Date(as.Date("2020-03-10"), today()-1, by="8 weeks")
seq(1,tail(res_biweekly$dates,1), by=49))
seq(1,tail(res_biweekly$dates,1), by=49)
length(seq(1,tail(res_biweekly$dates,1), by=49))
View(df_daily)
update_dataset()
update_dataset()
update_dataset()
shiny::runApp('Dropbox/Data Science_AM/cholera data/cholera')
install.packages("epiDisplay")
shiny::runApp('Dropbox/DHS_2022/DHS_app')
runApp('Dropbox/DHS_2022/DHS_app')
runApp('Dropbox/2014 DHS Data/2022_KDHS/shinyapp_DHS2022.R')
runApp('Dropbox/2014 DHS Data/2022_KDHS/shinyapp_DHS2022.R')
runApp('Dropbox/DHS_2022/DHS_app')
runApp('Dropbox/DHS_2022/DHS_app')
runApp('Dropbox/DHS_2022/DHS_app')
runApp('Dropbox/DHS_2022/DHS_app')
runApp('Dropbox/DHS_2022/DHS_app')
runApp('Dropbox/DHS_2022/DHS_app')
runApp('Dropbox/DHS_2022/DHS_app')
runApp('Dropbox/DHS_2022/test')
runApp('Dropbox/DHS_2022/test')
runApp('Dropbox/2014 DHS Data/2022_KDHS/shinyapp_DHS2022.R')
library(shinydashboard)
runApp('Dropbox/2014 DHS Data/2022_KDHS/shinyapp_DHS2022.R')
runApp('Dropbox/2014 DHS Data/2022_KDHS/shinyapp_DHS2022.R')
runApp('Dropbox/DHS_2022/DHS_app')
dataset <- read_csv(file.choose())
library(tidyverse)
dataset <- read_csv(file.choose())
dataset <- read_csv(file.choose()) %>%
janitor::clean_names()
herd_dynamics <- dataset %>%
select(household_id, village, interview_date,dynamics)
herd_dynamics <- dataset %>%
select(household_id, village, interview_date,herddynamics)
herd_dynamics <- dataset %>%
select(household_id, village, interview_date,herdynamics)
tabble(herd_dynamics$herdynamics)
table(herd_dynamics$herdynamics)
herd_dynamics <- dataset %>%
select(household_id, village, interview_date,herdynamics) %>%
separate(herdynamics, c("dynamics1", "dynamics2", "dynamics3", "dynamics4", "dynamics5"), sep=" ")%>%
mutate_at(vars(contains("dynamics")), funs(recode(., "1"="Births", "2"="Deaths", "3"="Gifts",
"4"="Given out", "5"="Purchased", "6"="Sold", "7"="None")))
head(herd_dynamics)
herd_dynamics <- dataset %>%
select(household_id, village, interview_date,herdynamics) %>%
separate(herdynamics, c("dynamics1", "dynamics2", "dynamics3", "dynamics4", "dynamics5"), sep=" ")%>%
mutate_at(vars(contains("dynamics")), funs(recode(., "1"="Births", "2"="Deaths", "3"="Gifts",
"4"="Given out", "5"="Purchased", "6"="Sold", "7"="None")))%>%
pivot_longer(contains("dynamics"), names_to = "dyn", values_to = "dynamics")
pivot_longer(contains("dynamics"), names_to = "dyn", values_to = "dynamics")%>%
ggplot(herd_dynamics, aes(x=interview_date, fill=dynamics))+geom_bar()+facet_grid(.~study_arm)
herd_dynamics <- dataset %>%
herd_dynamics <- dataset %>%
select(household_id, village, interview_date,herdynamics) %>%
separate(herdynamics, c("dynamics1", "dynamics2", "dynamics3", "dynamics4", "dynamics5"), sep=" ")%>%
mutate_at(vars(contains("dynamics")), funs(recode(., "1"="Births", "2"="Deaths", "3"="Gifts",
"4"="Given out", "5"="Purchased", "6"="Sold", "7"="None")))%>%
pivot_longer(contains("dynamics"), names_to = "dyn", values_to = "dynamics")%>%
mutate(study_arm=mutate(study_arm=ifelse(village%in%c("Lependera","Gobb Arbelle", "Nahgan-ngusa","Sulate", "Saale-Sambakah", "Namarei", "Manyatta Lengima","Lokoshula", "TubchaDakhane", "Rengumo-Gargule"),
"Study arm 1", ifelse(village%in%c("Galthelian-Torrder", "Uyam  village", "Galthelan Elemo", "Nebey", "Rongumo_kurkum", "Urawen_Kurkum", "Eisimatacho", "Manyatta K.A.G", "Ltepes Ooodo",
"Lorokushu", "Marti", "Manyatta Juu West/East", "Lbaarok1"), "Study arm 2","Study arm 3"))))
ggplot(herd_dynamics, aes(x=interview_date, fill=dynamics))+geom_bar()+facet_grid(.~study_arm)
ggplot(herd_dynamics, aes(x=interview_date, fill=dynamics))+geom_bar()#+facet_grid(.~study_arm)
herd_dynamics <- dataset %>%
select(household_id, village, interview_date,herdynamics) %>%
separate(herdynamics, c("dynamics1", "dynamics2", "dynamics3", "dynamics4", "dynamics5"), sep=" ")%>%
mutate_at(vars(contains("dynamics")), funs(recode(., "1"="Births", "2"="Deaths", "3"="Gifts",
"4"="Given out", "5"="Purchased", "6"="Sold", "7"="None")))%>%
pivot_longer(contains("dynamics"), names_to = "dyn", values_to = "dynamics")%>%
mutate(study_arm=mutate(study_arm=ifelse(village%in%c("Lependera","Gobb Arbelle", "Nahgan-ngusa","Sulate", "Saale-Sambakah", "Namarei", "Manyatta Lengima","Lokoshula", "TubchaDakhane", "Rengumo-Gargule"),
"Study arm 1", ifelse(village%in%c("Galthelian-Torrder", "Uyam  village", "Galthelan Elemo", "Nebey", "Rongumo_kurkum", "Urawen_Kurkum", "Eisimatacho", "Manyatta K.A.G", "Ltepes Ooodo",
"Lorokushu", "Marti", "Manyatta Juu West/East", "Lbaarok1"), "Study arm 2","Study arm 3"))))%>%
mutate(study_arm=ifelse(study_arm%in%c("---", "None"), NA, study_arm))
ggplot(herd_dynamics, aes(x=interview_date, fill=dynamics))+geom_bar()#+facet_grid(.~study_arm)
herd_dynamics <- dataset %>%
select(household_id, village, interview_date,herdynamics) %>%
separate(herdynamics, c("dynamics1", "dynamics2", "dynamics3", "dynamics4", "dynamics5"), sep=" ")%>%
mutate_at(vars(contains("dynamics")), funs(recode(., "1"="Births", "2"="Deaths", "3"="Gifts",
"4"="Given out", "5"="Purchased", "6"="Sold", "7"="None")))%>%
pivot_longer(contains("dynamics"), names_to = "dyn", values_to = "dynamics")%>%
mutate(study_arm=mutate(study_arm=ifelse(village%in%c("Lependera","Gobb Arbelle", "Nahgan-ngusa","Sulate", "Saale-Sambakah", "Namarei", "Manyatta Lengima","Lokoshula", "TubchaDakhane", "Rengumo-Gargule"),
"Study arm 1", ifelse(village%in%c("Galthelian-Torrder", "Uyam  village", "Galthelan Elemo", "Nebey", "Rongumo_kurkum", "Urawen_Kurkum", "Eisimatacho", "Manyatta K.A.G", "Ltepes Ooodo",
"Lorokushu", "Marti", "Manyatta Juu West/East", "Lbaarok1"), "Study arm 2","Study arm 3"))))%>%
mutate(study_arm=ifelse(study_arm%in%c("---", "None"), NA, study_arm))
herd_dynamics <- dataset %>%
select(household_id, village, interview_date,herdynamics) %>%
separate(herdynamics, c("dynamics1", "dynamics2", "dynamics3", "dynamics4", "dynamics5"), sep=" ")%>%
mutate_at(vars(contains("dynamics")), funs(recode(., "1"="Births", "2"="Deaths", "3"="Gifts",
"4"="Given out", "5"="Purchased", "6"="Sold", "7"="None")))%>%
pivot_longer(contains("dynamics"), names_to = "dyn", values_to = "dynamics")%>%
mutate(study_arm=ifelse(village%in%c("Lependera","Gobb Arbelle", "Nahgan-ngusa","Sulate", "Saale-Sambakah", "Namarei", "Manyatta Lengima","Lokoshula", "TubchaDakhane", "Rengumo-Gargule"),
"Study arm 1", ifelse(village%in%c("Galthelian-Torrder", "Uyam  village", "Galthelan Elemo", "Nebey", "Rongumo_kurkum", "Urawen_Kurkum", "Eisimatacho", "Manyatta K.A.G", "Ltepes Ooodo",
"Lorokushu", "Marti", "Manyatta Juu West/East", "Lbaarok1"), "Study arm 2","Study arm 3")))%>%
mutate(study_arm=ifelse(study_arm%in%c("---", "None"), NA, study_arm))
ggplot(herd_dynamics, aes(x=interview_date, fill=dynamics))+geom_bar()#+facet_grid(.~study_arm)
herd_dynamics <- dataset %>%
select(household_id, village, interview_date,herdynamics) %>%
separate(herdynamics, c("dynamics1", "dynamics2", "dynamics3", "dynamics4", "dynamics5"), sep=" ")%>%
mutate_at(vars(contains("dynamics")), funs(recode(., "1"="Births", "2"="Deaths", "3"="Gifts",
"4"="Given out", "5"="Purchased", "6"="Sold", "7"="None")))%>%
pivot_longer(contains("dynamics"), names_to = "dyn", values_to = "dynamics")%>%
mutate(study_arm=ifelse(village%in%c("Lependera","Gobb Arbelle", "Nahgan-ngusa","Sulate", "Saale-Sambakah", "Namarei", "Manyatta Lengima","Lokoshula", "TubchaDakhane", "Rengumo-Gargule"),
"Study arm 1", ifelse(village%in%c("Galthelian-Torrder", "Uyam  village", "Galthelan Elemo", "Nebey", "Rongumo_kurkum", "Urawen_Kurkum", "Eisimatacho", "Manyatta K.A.G", "Ltepes Ooodo",
"Lorokushu", "Marti", "Manyatta Juu West/East", "Lbaarok1"), "Study arm 2","Study arm 3")))%>%
mutate(dynamics=ifelse(dynamics%in%c("---", "None"), NA, dynamics))
ggplot(herd_dynamics, aes(x=interview_date, fill=dynamics))+geom_bar()#+facet_grid(.~study_arm)
ggplot(herd_dynamics, aes(x=interview_date, fill=dynamics))+geom_bar()+facet_grid(.~study_arm)
ggplot(herd_dynamics, aes(x=interview_date, fill=dynamics))+geom_bar()+facet_grid(.~study_arm)+
theme_bw()
ggplot(herd_dynamics[!is.na(herd_dynamics$dynamics),], aes(x=interview_date, fill=dynamics))+geom_bar()+facet_grid(.~study_arm)+
theme_bw()
read_csv("https://raw.githubusercontent.com/cema-uonbi/L4H_sample_data/main/ideal3a.csv ")
read_csv("https://raw.githubusercontent.com/cema-uonbi/L4H_sample_data/main/ideal3a.csv")
read_csv("https://raw.githubusercontent.com/cema-uonbi/L4H_sample_data/main/ideal3a.csv")
read_csv("https://raw.githubusercontent.com/cema-uonbi/L4H_sample_data/main/ideal3a.csv")
read_csv("https://raw.githubusercontent.com/cema-uonbi/L4H_sample_data/main/ideal3a.csv")https://raw.githubusercontent.com/cema-uonbi/L4H_sample_data/main/ideal3a.csv
read_csv("https://raw.githubusercontent.com/cema-uonbi/L4H_sample_data/main/ideal3a.csv")https://raw.githubusercontent.com/cema-uonbi/L4H_sample_data/main/ideal3a.csv
read_csv("https://raw.githubusercontent.com/cema-uonbi/L4H_sample_data/main/ideal3a.csv")
knitr::opts_chunk$set(echo = TRUE)
## Load packages
library(foreign)
library(tidyverse)
library(janitor)
library(haven)
library(sjPlot)
RTA <- read_csv("table_2_17_RTA_by_background_xtics.csv")
RTA <- read_csv("data/table_2/table_2_17_RTA_by_background_xtics.csv")
RTA <- read_csv("data/table_2/table_2_17_RTA_by_background_xtics.csv")
RTA <- read_csv("data/table_2/table_2_17_RTA_by_background_xtics.csv")
head(RTA)
table(RTA$`Background characteristics`)
radioButtons("cooking", "",
c("Cooking place"="Cooking place",
"Cooking technology"="Cooking technology",
"Cooking fuel"="Cooking fuel"))
cooking <- read_csv("data/table_2/table2_2_Cooking_by_xtics.csv") %>%
filter(!Category%in%"Total")
cooking <- read_csv("data/table_2/table2_2_Cooking_by_xtics.csv") %>%
filter(!Category%in%"Total")
??renderPlot
covid <- read_csv("table_2_19_1_covid_by_background_xtics.csv")
covid <- read_csv("data/table_2/table_2_19_1_covid_by_background_xtics.csv")
setwd("~/Dropbox/GitHub/2022_KDHS")
covid <- read_csv("data/table_2/table_2_19_1_covid_by_background_xtics.csv")
head(covid)
table(covid$Value)
covid$Value <- fct_relevel(covid$Value, "Lowest", "Second", "Middle", "Fourth", "Highest", "Rural", "Urban")
table(covid$`Background characteristics`)
1000*150
library(flexdashboard)
source("script/WHO_report_analysis.R")
data <- read.csv("https://covid19.who.int/WHO-COVID-19-global-data.csv") %>%
#rename(Date_reported=Date_reported) %>%
mutate(Date_reported=as.Date(Date_reported, format = "%Y-%m-%d"))%>%
filter(WHO_region%in%"AFRO")
table(data$WHO_region)
max(data$Cumulative_cases)
sum(data$Cumulative_cases)
table(data$Cumulative_cases)
View(data)
View(africa_data)
today<- max(data$Date_reported)
cum_cases <- data %>%
filter(Date_reported==today)
sum(cum_cases$Cumulative_deaths)
today <- Sys.Date()-1
cum_cases <- data %>%
filter(Date_reported==today)
sum(cum_cases$Cumulative_deaths)
today
cum_cases <- data %>%
filter(Date_reported==today)
table(cum_cases$Date_reported)
table(data$Date_reported)
max(data$Date_reported)
today<- max(data$Date_reported)
cum_cases <- data %>%
filter(Date_reported==today)
format(sum(cum_cases$Cumulative_cases), big.mark = ",")
WHO_cases_and_deaths %>% filter(date == today) %>% pull(cum_deaths) %>% sum()))
WHO_cases_and_deaths %>% filter(date == today) %>% pull(cum_deaths) %>% sum())
WHO_cases_and_deaths %>% filter(date == today) %>% pull(cum_deaths) %>% sum()
RTA <- read_csv("data/table_2/table_2_17_RTA_by_background_xtics.csv")
head(RTA)
head(covid)
covid_county1 <- full_join(county, covid_county, by="County")
covid_county <- read_csv("data/table_2/table_2_19_1C_covid_by_county.csv")%>%
mutate(County=recode(County,"Tharaka-Nithi"="Tharaka Nithi", "Elgeyo/Marakwet"="Elgeyo Marakwet","Murang’a"="Muranga", "Nairobi City"="Nairobi", "Taita/Taveta"="Taita Taveta"))%>%
mutate(Proportion=as.numeric(Proportion))%>%
mutate(Names=paste0(County,", ", Proportion,"%"))
covid_county1 <- full_join(county, covid_county, by="County")
county <- st_read("shapefiles/County.shp")
covid_county1 <- full_join(county, covid_county, by="County")
covid_county1 <- full_join(county, covid_county, by=c("Name"="County"))
names(county)
names(covid_county)
covid_county1 <- full_join(county, covid_county, by=c("Name"="County"))
head(covid_county)
covid_county1 <- full_join(county, covid_county%>%filter(Participants%in%"Households"), by=c("Name"="County")) %>%
mutate(Participants="Households")
table(covid_county$Participants)
covid_county1 <- full_join(county, covid_county%>%filter(Participants%in%"Households")%>%distinct(), by=c("Name"="County")) %>%
mutate(Participants="Households")
View(covid_county)
covid_county1 <- full_join(county, covid_county%>%filter(Participants%in%"Households")%>%distinct(), by=c("Name"="County")) %>%
mutate(Participants="Households")
covid_county2 <- full_join(county, covid_county%>%filter(Participants%in%"Population"), by=c("Name"="County")) %>%
mutate(Participants="Population")
covid_county3 <- rbind(covid_county1, covid_county2)
ggplot(covid_county1%>%filter(Participants%in%"Households"))+
geom_sf(data=covid_county1, aes(geometry=geometry), fill=NA)+
geom_sf(aes(fill=Proportion),color="grey80", size=0.0)+
theme_void()+
facet_wrap(~Category)+
scale_fill_gradient(low = "white", high = "#8c2d04")+
labs(x="", y="",fill="Households - Proportion (%)")+
theme(text=element_text(size=14))
covid_map1 <- ggplot(covid_county1%>%filter(Participants%in%"Households"))+
geom_sf(data=covid_county1, aes(geometry=geometry), fill=NA)+
geom_sf(aes(fill=Proportion),color="grey80", size=0.0)+
theme_void()+
facet_wrap(~Category)+
scale_fill_gradient(low = "white", high = "#8c2d04")+
labs(x="", y="",fill="Households - Proportion (%)")+
theme(text=element_text(size=14))
covid_map1
geom_sf(data=covid_county1, aes(geometry=geometry), fill=NA)+
geom_sf(aes(fill=Proportion),color="grey80", size=0.0)+
theme_void()+
facet_wrap(Participants~Category)+
scale_fill_gradient(low = "white", high = "#8c2d04")+
labs(x="", y="",fill="Households - Proportion (%)")+
theme(text=element_text(size=14))
ggplot(covid_county3)+
geom_sf(data=covid_county1, aes(geometry=geometry), fill=NA)+
geom_sf(aes(fill=Proportion),color="grey80", size=0.0)+
theme_void()+
facet_wrap(Participants~Category)+
scale_fill_gradient(low = "white", high = "#8c2d04")+
labs(x="", y="",fill="Households - Proportion (%)")+
theme(text=element_text(size=14))
library(ggiraph)
?geom_sf_interactive
# health insurance data by age
insurance <- read_csv("table_2_20_insurance_by_background_xtics.csv")
# health insurance data by age
insurance <- read_csv("data/table_2/table_2_20_insurance_by_background_xtics.csv")
head(
insurance
)
table(insurance$`Background characteristics`)
table(insurance$`Value`)
insurance$Value <- fct_relevel(insurance$Value, "Lowest", "Second", "Middle", "Fourth", "Highest")
table(insurance$`Health Insurance Type`)
insurance$`Health Insurance Type` <- fct_relevel(insurance$`Health Insurance Type`, "NHIF", "Private/commercial", "Community based", "Other", "Form of health insurance", "None/ Don't Know")
insurance$`Health Insurance Type` <- fct_relevel(insurance$`Health Insurance Type`, "NHIF", "Private/commercial", "Community based", "Other", "Form of health insurance", "None/Don't Know")
insurance$`Health Insurance Type` <- fct_relevel(insurance$`Health Insurance Type`, "NHIF", "Private/commercial", "Community based", "Other", "Form of health insurance", "None/Don't know")
insurance$`Health Insurance Type` <- fct_relevel(insurance$`Health Insurance Type`,"Any", "NHIF", "Private/commercial", "Community-based", "Other", "None/Don't know")
head(insurance)
insurance_county <- read_csv("data/table_2/table_2_20C_insurance_by_county.csv")%>%
mutate(County=recode(County,"Tharaka-Nithi"="Tharaka Nithi", "Elgeyo/Marakwet"="Elgeyo Marakwet","Murang’a"="Muranga", "Nairobi City"="Nairobi", "Taita/Taveta"="Taita Taveta"))%>%
mutate(Proportion=as.numeric(Proportion))%>%
mutate(Names=paste0(County,", ", Proportion,"%"))
insurance_county1 <- full_join(county, insurance_county, by=c("Name"="County"))
cash_transfer <- read_csv("data/table_2/table_2_22_1_cash_transfer_by_provider.csv")%>%
mutate(lab = str_c(Proportion,"%"))
head(cash_transfer)
cash_transfer_plot <- ggplot(cash_transfer, aes(x=reorder(`Reason For Assistance`,Proportion), y=Proportion))+
geom_bar(stat = "identity", fill="#74add1")+
theme_bw()+
facet_wrap(~Provider)+
labs( y="Proportion (%)", title="", x="Reason for assistance", fill="")+
theme(text=element_text(size=12))+
geom_text(aes(label = lab), nudge_y = 2.0)+
coord_flip()
cash_transfer_plot
table(cash_transfer$Provider)
cash_transfer <- read_csv("data/table_2/table_2_22_1_cash_transfer_by_provider.csv")%>%
mutate(lab = str_c(Proportion,"%")) %>%
mutate(Provider1=recode(Provider, "Church, mosque, or any other religious organization"="Religious organization", "NGO. CBO, or other charitable organization"="Charitable organization"))
table(cash_transfer$Provider1)
# health insurance data by age
insurance <- read_csv("data/table_2/table_2_20_insurance_by_background_xtics.csv")
table(insurance$`Background characteristics`)
head(insurance)
ggplot(insurance[insurance$`Background characteristics`%in%"Age",], aes(x=Value, y=Proportion))+geom_bar(stat = 'identity', position = position_dodge(), fill="#74add1")+#,aes(tooltip=paste0(Coverage, "%"))) +
labs(y="Percent (%)", x="")+
coord_flip()+
theme_bw()+theme(text=element_text(size=16, face = "bold")) +
# theme(strip.background =element_rect(fill="darkorange"))+
geom_text(aes(label=paste0(proportion,"%")), position=position_dodge(0.5),vjust=0.5, size=4, color="black")
head(insurance)
insurance[insurance$`Background characteristics`%in%"Age",]
